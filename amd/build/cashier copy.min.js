define("local_shopping_cart/cashier copy",["exports","core/ajax","core/url","local_shopping_cart/notifications","core_form/modalform","local_shopping_cart/cart","core/str"],(function(_exports,_ajax,_url,_notifications,_modalform,_cart,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    local_shopping_cart
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.confirmPayment=_exports.addPrintIdentifier=void 0,_exports.discountModal=function(event){var element=event.target.closest("li");console.log("closest",element);var price=element.dataset.price,itemid=element.dataset.itemid,userid=element.dataset.userid,componentname=element.dataset.component,area=element.dataset.area;console.log("discountModal",price,itemid,userid,componentname,"area "+area);var modalForm=new _modalform.default({formClass:"local_shopping_cart\\form\\modal_add_discount_to_item",args:{price:price,itemid:itemid,userid:userid,componentname:componentname,area:area},modalConfig:{title:(0,_str.get_string)("applydiscount","local_shopping_cart")},returnFocus:element});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(function(e){var response=e.detail;console.log("confirmCancelAndSetCreditModal response: ",response),(0,_cart.reinit)(-1)})),modalForm.show()},_exports.validateCart=_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_url=_interopRequireDefault(_url),_modalform=_interopRequireDefault(_modalform);_exports.init=function(){var userid=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;console.log("run init",userid),document.getElementById("checkout-tab").classList.remove("success");var buybuttons=document.querySelectorAll(".buy-btn");buybuttons&&buybuttons.forEach((function(buybutton){buybutton.addEventListener("click",(function(e){return confirmPayment(userid,e.target.dataset.paymenttype)}))}));var checkoutbutton=document.querySelector("#checkout-btn");console.log(checkoutbutton),checkoutbutton&&checkoutbutton.addEventListener("click",(function(){document.getElementById("checkout-tab").classList.add("success"),console.log("click")}))};var confirmPayment=function(userid,paymenttype){_ajax.default.call([{methodname:"local_shopping_cart_confirm_cash_payment",args:{userid:userid,paymenttype:paymenttype},done:function(data){if(1===data.status)if(console.log("payment confirmed",data),window.location.href.indexOf("cashier.php")<1){var params={success:1,identifier:data.identifier},newurl=_url.default.relativeUrl("/local/shopping_cart/checkout.php",params,!1);location.href=newurl}else addPrintIdentifier(data.identifier,userid),document.getElementById("success-tab").classList.add("success"),displayPaymentMessage("paymentsuccessful");else console.log("payment denied"),displayPaymentMessage("paymentdenied",!1),document.getElementById("success-tab").classList.add("error")},fail:function(ex){displayPaymentMessage("paymentdenied",!1),console.log(ex)}}])};_exports.confirmPayment=confirmPayment;_exports.validateCart=function($userid){alert($userid)};var addPrintIdentifier=function(identifier,userid){var printbtn=document.getElementById("printbtn"),href=printbtn.getAttribute("href");printbtn.setAttribute("href",href+identifier+"&userid="+userid)};function displayPaymentMessage(message){var success=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],displaymessage=document.querySelector(".payment_message_result");displaymessage&&(0,_str.get_string)(message,"local_shopping_cart").then((function(localizedmessage){displaymessage.innerText=localizedmessage,success?(0,_notifications.showNotification)(localizedmessage,"info"):(0,_notifications.showNotification)(localizedmessage,"error")})).catch((function(e){console.log(e)}))}_exports.addPrintIdentifier=addPrintIdentifier}));

//# sourceMappingURL=cashier copy.min.js.map