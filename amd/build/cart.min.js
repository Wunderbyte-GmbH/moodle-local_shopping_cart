define ("local_shopping_cart/cart",["exports","core/ajax","core/templates","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.addItem=a.deleteItem=a.deleteAllItems=a.init=a.buttoninit=a.itemsleft=a.maxitems=a.interval=a.countdownelement=void 0;b=e(b);c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}var i=null;a.countdownelement=i;var j=null;a.interval=j;var k=null;a.maxitems=k;var l=null;a.itemsleft=l;a.buttoninit=function buttoninit(a,b){console.log("initialized",a,b);var c=document.querySelector("#btn-"+b+"-"+a);if(!c){return}c.querySelector(".loadJavascript").remove();var d=c.querySelector("span");if(d){d.classList.remove("hidden")}var e=document.querySelector("#nav-shopping_cart-popover-container");if(e){var f=e.querySelector("#item-"+b+"-"+a);if(f){c.classList.add("disabled")}}c.addEventListener("click",function(d){if(c.classList.contains("disabled")){return}d.preventDefault();d.stopPropagation();p(a,b)})};var m=function(b,c,d){a.countdownelement=i=document.querySelector(".expirationdate");a.maxitems=k=c;d=parseInt(d)?parseInt(d):0;a.itemsleft=l=k-d;console.log(k+" "+l);h(b);document.querySelectorAll(".fa-trash-o").forEach(function(a){f(a)})};a.init=m;var n=function(){b.default.call([{methodname:"local_shopping_cart_delete_all_items_from_cart",args:{},done:function done(){var b=document.querySelectorAll("[id^=item-]");b.forEach(function(a){if(a){a.remove()}});a.itemsleft=l=k;var c=document.querySelectorAll("#totalprice");c.forEach(function(a){a.innerHTML=0});var d=document.getElementById("countbadge"),e=document.getElementById("itemcount");d.innerHTML=0;e.innerHTML=0;e.classList.add("hidden");var f=document.querySelectorAll("[id^=btn-].disabled");f.forEach(function(a){if(a){a.classList.remove("disabled")}})},fail:function fail(a){console.log(a)}}])};a.deleteAllItems=n;var o=function(c,d){b.default.call([{methodname:"local_shopping_cart_delete_item",args:{itemid:c,component:d},done:function done(){a.itemsleft=l=l+1;console.log(c);var b=document.querySelectorAll("#item-"+d+"-"+c),e=b[0].dataset.price;b.forEach(function(a){if(a){a.remove()}});var f=document.querySelectorAll("#totalprice");f.forEach(function(a){a="undefined"==a?a=0:a;a.innerHTML-=e});var g=document.getElementById("countbadge"),h=document.getElementById("itemcount");g.innerHTM=0<g.innerHTML?g.innerHTML-=1:g.innerHTML;h.innerHTML=0<h.innerHTML?h.innerHTML-=1:g.innerHTML;h.innerHTML=0==h.innerHTML?h.classList.add("hidden"):h.innerHTML;var i=document.querySelector("#btn-"+d+"-"+c);if(i){i.classList.remove("disabled")}},fail:function fail(a){console.log(c,a);var b=document.querySelector("#item-"+d+"-"+c);if(b){b.remove();var e=document.getElementById("countbadge"),f=document.getElementById("itemcount");e.innerHTML=0<e.innerHTML?e.innerHTML-=1:e.innerHTML;f.innerHTML=0<f.innerHTML?f.innerHTML-=1:e.innerHTML;f.innerHTML=0==f.innerHTML?f.classList.add("hidden"):f.innerHTML;var g=b.dataset.price,h=document.getElementById("totalprice");h="undefined"==h?h=0:h;h.innerHTML-=g}}}])};a.deleteItem=o;var p=function(e,g){console.log(l);if(0==l){d.default.addNotification({message:"Cart is full",type:"danger"});return}b.default.call([{methodname:"local_shopping_cart_add_item",args:{component:g,itemid:e},done:function done(b){b.component=g;b.id=e;d.default.addNotification({message:b.name+" added to cart",type:"success"});c.default.renderForPromise("local_shopping_cart/shopping_cart_item",b).then(function(c){var d=c.html,e=document.getElementById("litotalprice");e.insertAdjacentHTML("beforeBegin",d);document.getElementById("countbadge").innerHTML++;var i=document.getElementById("itemcount");i.innerHTML=(parseInt(i.innerHTML)||0)+1;i.classList.remove("hidden");var k=document.getElementById("totalprice");k.innerHTML=(parseInt(k.innerHTML)||0)+parseInt(b.price);var m=document.querySelector("#item-"+g+"-"+b.itemid+" .fa-trash-o");a.itemsleft=l=l-1;f(m);clearInterval(j);h(b.expirationdate);var n=document.querySelector("#btn-"+g+"-"+b.itemid);if(n){n.classList.add("disabled")}})},fail:function fail(a){console.log("error",a)}}],!0)};a.addItem=p;function f(a){a.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();console.log("delete clicked",a.dataset.id);var c=a.dataset.id.split("-"),d=c.pop(),e=c.pop();o(d,e)})}function g(b,c){var d=b,e,f;a.interval=j=setInterval(function(){e=parseInt(d/60,10);f=parseInt(d%60,10);e=10>e?"0"+e:e;f=10>f?"0"+f:f;console.log(e+" "+f);c.textContent=e+":"+f;if(0>--d){n();console.log("delete");clearInterval(j)}},1e3)}function h(a){if(j){clearInterval(j)}var b=0,c=Date.now("UTC");c=new Date().getTime()/1e3;b=a-c;console.log(b);if(0>b){b=0}g(b,i)}});
//# sourceMappingURL=cart.min.js.map
