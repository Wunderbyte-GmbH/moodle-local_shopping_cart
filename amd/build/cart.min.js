define ("local_shopping_cart/cart",["exports","core/ajax","core/templates","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.updateTotalPrice=a.addItem=a.deleteItem=a.deleteAllItems=a.reinit=a.init=a.buttoninit=a.reloadAllButtons=a.visbilityevent=a.interval=a.countdownelement=void 0;b=e(b);c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}var j=null;a.countdownelement=j;var k=null;a.interval=k;var l=!1;a.visbilityevent=l;var m=function(){var a=document.querySelectorAll("[id^=btn-]");a.forEach(function(a){a.classList.remove("disabled")})};a.reloadAllButtons=m;var n=function(a,b){if(!a){var e=document.querySelectorAll("[id^='btn-"+b+"']");e.forEach(function(a){var c=a.id.split(/[\s-]+/).pop();n(c,b)});return}var c=document.querySelector("#btn-"+b+"-"+a);if(!c||c.dataset.initialized){return}var d=document.querySelector("#shopping_cart-cashiers-cart");if(!d){d=document.querySelector("#nav-shopping_cart-popover-container")}if(d){var f=d.querySelector("#item-"+b+"-"+a);if(f){c.classList.add("disabled")}}c.addEventListener("click",function(d){console.log("button clicked",a);if(c.classList.contains("disabled")){return}d.preventDefault();d.stopPropagation();s(a,b)});c.dataset.initialized=!0};a.buttoninit=n;var o=function(b){a.countdownelement=j=document.querySelector(".expirationdate");i(b);if(!1==l){var c=document.querySelectorAll("[id^=item-] .fa-trash-o");c.forEach(function(a){f(a)});document.addEventListener("visibilitychange",function(){a.visbilityevent=l=!0;if("visible"===document.visibilityState){p()}})}t()};a.init=o;var p=function(){m();b.default.call([{methodname:"local_shopping_cart_get_shopping_cart_items",args:{},done:function done(a){c.default.renderForPromise("local_shopping_cart/shopping_cart_items",a).then(function(b){var c=b.html;document.querySelector(".shopping-cart-items").remove();var d=document.querySelector("#nav-shopping_cart-popover-container .shopping-cart-items-container");d.insertAdjacentHTML("afterbegin",c);a.items.forEach(function(a){n(a.itemid,a.itemcomponent)});var e=document.querySelectorAll(".fa-trash-o");e.forEach(function(a){f(a)});var g=document.getElementById("itemcount");g.innerHTML=a.count;document.getElementById("countbadge").innerHTML=a.count;if(0<a.count){g.classList.remove("hidden")}else{g.classList.add("hidden")}i(a.expirationdate);return!0}).catch(function(a){console.log(a)})},fail:function fail(a){console.log("ex:"+a)}}])};a.reinit=p;var q=function(){b.default.call([{methodname:"local_shopping_cart_delete_all_items_from_cart",args:{},done:function done(){var a=document.querySelectorAll("[id^=item-]");a.forEach(function(a){if(a){a.remove()}});t();var b=document.getElementById("countbadge"),c=document.getElementById("itemcount");b.innerHTML=0;c.innerHTML=0;c.classList.add("hidden");var d=document.querySelectorAll("[id^=btn-].disabled");d.forEach(function(a){if(a){a.classList.remove("disabled")}})},fail:function fail(a){console.log(a)}}])};a.deleteAllItems=q;var r=function(a,c,d){b.default.call([{methodname:"local_shopping_cart_delete_item",args:{itemid:a,component:c,userid:d},done:function done(){var b=document.querySelectorAll("#item-"+c+"-"+a);b.forEach(function(a){if(a){a.remove()}});t(d);var e=document.getElementById("countbadge"),f=document.getElementById("itemcount");e.innerHTM=0<e.innerHTML?e.innerHTML-=1:e.innerHTML;f.innerHTML=0<f.innerHTML?f.innerHTML-=1:e.innerHTML;if(0==f.innerHTML){f.classList.add("hidden");clearInterval(k);i()}var g=document.querySelector("#btn-"+c+"-"+a);if(g){g.classList.remove("disabled");n(a,c)}},fail:function fail(b){console.log(a,b);var e=document.querySelector("#item-"+c+"-"+a);if(e){e.remove();var f=document.getElementById("countbadge"),g=document.getElementById("itemcount");f.innerHTML=0<f.innerHTML?f.innerHTML-=1:f.innerHTML;g.innerHTML=0<g.innerHTML?g.innerHTML-=1:f.innerHTML;g.innerHTML=0==g.innerHTML?g.classList.add("hidden"):g.innerHTML;var h=e.dataset.price;console.log("itemprice",h);t(d)}}}])};a.deleteItem=r;var s=function(a,e){b.default.call([{methodname:"local_shopping_cart_add_item",args:{component:e,itemid:a},done:function done(b){b.component=e;b.id=a;b.userid=b.buyforuser;console.log("buyforuser",b.buyforuser);if(1!=b.success){d.default.addNotification({message:"Cart is full",type:"danger"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert.alert-danger"),b=a[a.length-1];b.remove()},5e3)}else if(1==b.success){d.default.addNotification({message:b.itemname+" added to cart",type:"success"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert.alert-success"),b=a[a.length-1];b.remove()},5e3);c.default.renderForPromise("local_shopping_cart/shopping_cart_item",b).then(function(a){var c=a.html,d=document.querySelectorAll("[id^='liinitialtotal']");d.forEach(function(a){console.log("found li",a);if(0==b.buyforuser||"liinitialtotal_cashier"===a.id){a.insertAdjacentHTML("beforeBegin",c)}});var h=document.querySelector("#btn-"+e+"-"+b.itemid);if(h){h.classList.add("disabled");h.removeEventListener("click",g)}var j=document.querySelectorAll("#item-"+e+"-"+b.itemid+" .fa-trash-o");j.forEach(function(a){f(a,b.userid)});t(b.userid);if(0!=b.buyforuser){return}document.getElementById("countbadge").innerHTML++;var l=document.getElementById("itemcount");l.innerHTML=(parseInt(l.innerHTML)||0)+1;l.classList.remove("hidden");t(b.userid);clearInterval(k);i(b.expirationdate)}).catch(function(a){console.log(a)})}},fail:function fail(a){console.log("error",a)}}],!0)};a.addItem=s;var t=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;console.log("updatetotalprice");var e=document.querySelectorAll(".sc_price_label");e.forEach(function(b){console.log(b);a=b.dataset.userid?b.dataset.userid:a;var c=b.querySelector("input.usecredit-checkbox");if(c){if(c.checked){console.log("checked",c.checked);d=c.checked}else{d=0}}});d=d?1:0;console.log("usecredit before ajax",d);b.default.call([{methodname:"local_shopping_cart_get_price",args:{userid:a,usecredit:d},done:function done(b){console.log(b);if(1==b.usecredit){b.usecreditclass="checked"}else{b.usecreditclass=""}var d=b.initialtotal,f=document.querySelector("#shopping_cart-cashiers-cart"),g=null,h=null,i=null;if(!f){f=document.querySelector("#nav-shopping_cart-popover-container");h=document.querySelector("div.checkoutgrid.checkout");console.log("1",h)}else{g=document.querySelector("#shopping_cart-cashiers-section")}var j=[];if(g){j=g.querySelectorAll(".initialtotal")}else{j=f.querySelectorAll(".initialtotal");if(h){i=h.querySelectorAll(".initialtotal");if(i){i.forEach(function(a){a.innerHTML=d})}}}j.forEach(function(a){a.innerHTML=d});var k=document.querySelector(".shopping_cart_payment_region button");if(k){var l=b.initialtotal,m=b.currency;k.dataset.cost=l+" "+m}b.checkboxid=Math.random().toString(36).slice(2,5);c.default.renderForPromise("local_shopping_cart/price_label",b).then(function(b){var c=b.html;e.forEach(function(b){var d=b.lastElementChild;while(d){b.removeChild(d);d=b.lastElementChild}b.insertAdjacentHTML("afterbegin",c);var e=b.querySelector("input.usecredit-checkbox");if(e){e.addEventListener("change",function(b){console.log(b);t(a)})}});return!0}).catch(function(a){console.log(a)})},fail:function fail(a){console.log("error",a)}}],!0)};a.updateTotalPrice=t;function f(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;if(0!=b){a.dataset.userid=b}a.addEventListener("click",g)}function g(){var a=this;console.log("item",a);var b=a.dataset.id.split("-");console.log("idarray",b);var c=b.pop(),d=b.pop(),e=parseInt(a.dataset.userid);if(!e){e=0}r(c,d,e)}function h(b,c){var d=b,e,f;a.interval=k=setInterval(function(){e=parseInt(d/60,10);f=parseInt(d%60,10);e=10>e?"0"+e:e;f=10>f?"0"+f:f;c.textContent=e+":"+f;if(0>--d){q();clearInterval(k)}},1e3)}function i(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;if(k){clearInterval(k)}var b=0,c=Date.now("UTC");c=new Date().getTime()/1e3;if(a){b=a-c}if(0>=b){b=0;j.classList.add("hidden")}else if(0<b){j.classList.remove("hidden");h(b,j)}}});
//# sourceMappingURL=cart.min.js.map
