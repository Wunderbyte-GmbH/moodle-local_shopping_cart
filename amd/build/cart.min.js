define ("local_shopping_cart/cart",["exports","core/ajax","core/templates","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.addItem=a.deleteItem=a.deleteAllItems=a.reinit=a.init=a.buttoninit=a.reloadAllButtons=a.visbilityevent=a.interval=a.countdownelement=void 0;b=e(b);c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}var i=null;a.countdownelement=i;var j=null;a.interval=j;var k=!1;a.visbilityevent=k;var l=function(){var a=document.querySelectorAll("[id^=btn-]");a.forEach(function(a){a.classList.remove("disabled")})};a.reloadAllButtons=l;var m=function(a,b){if(!a){var e=document.querySelectorAll("[id^='btn-"+b+"']");e.forEach(function(a){var c=a.id.split(/[\s-]+/).pop();m(c,b)});return}var c=document.querySelector("#btn-"+b+"-"+a);if(!c){return}var d=document.querySelector("#nav-shopping_cart-popover-container");if(d){var f=d.querySelector("#item-"+b+"-"+a);if(f){c.classList.add("disabled")}}c.addEventListener("click",function(d){if(c.classList.contains("disabled")){return}d.preventDefault();d.stopPropagation();r(a,b)})};a.buttoninit=m;var n=function(b){a.countdownelement=i=document.querySelector(".expirationdate");h(b);if(!1==k){var c=document.querySelectorAll("[id^=item-] .fa-trash-o");c.forEach(function(a){f(a)});document.addEventListener("visibilitychange",function(){a.visbilityevent=k=!0;if("visible"===document.visibilityState){o()}})}};a.init=n;var o=function(){l();b.default.call([{methodname:"local_shopping_cart_get_shopping_cart_items",args:{},done:function done(a){c.default.renderForPromise("local_shopping_cart/shopping_cart_items",a).then(function(b){var c=b.html;document.querySelector(".shopping-cart-items").remove();var d=document.querySelector("#nav-shopping_cart-popover-container .popover-region-content-container");d.insertAdjacentHTML("afterbegin",c);a.items.forEach(function(a){m(a.itemid,a.itemcomponent)});var e=document.querySelectorAll(".fa-trash-o");e.forEach(function(a){f(a)});var g=document.getElementById("itemcount");g.innerHTML=a.count;document.getElementById("countbadge").innerHTML=a.count;if(0<a.count){g.classList.remove("hidden")}else{g.classList.add("hidden")}h(a.expirationdate);return!0}).catch(function(a){console.log(a)})},fail:function fail(a){console.log("ex:"+a)}}])};a.reinit=o;var p=function(){b.default.call([{methodname:"local_shopping_cart_delete_all_items_from_cart",args:{},done:function done(){var a=document.querySelectorAll("[id^=item-]");a.forEach(function(a){if(a){a.remove()}});var b=document.querySelectorAll("#totalprice");b.forEach(function(a){a.innerHTML=0});var c=document.getElementById("countbadge"),d=document.getElementById("itemcount");c.innerHTML=0;d.innerHTML=0;d.classList.add("hidden");var e=document.querySelectorAll("[id^=btn-].disabled");e.forEach(function(a){if(a){a.classList.remove("disabled")}})},fail:function fail(a){console.log(a)}}])};a.deleteAllItems=p;var q=function(a,c,d){b.default.call([{methodname:"local_shopping_cart_delete_item",args:{itemid:a,component:c,userid:d},done:function done(){var b=document.querySelectorAll("#item-"+c+"-"+a),d=b[0].dataset.price;b.forEach(function(a){if(a){a.remove()}});var e=document.querySelectorAll("#totalprice");e.forEach(function(a){a="undefined"==a?a=0:a;a.innerHTML-=d});var f=document.getElementById("countbadge"),g=document.getElementById("itemcount");f.innerHTM=0<f.innerHTML?f.innerHTML-=1:f.innerHTML;g.innerHTML=0<g.innerHTML?g.innerHTML-=1:f.innerHTML;if(0==g.innerHTML){g.classList.add("hidden");clearInterval(j);h()}var i=document.querySelector("#btn-"+c+"-"+a);if(i){i.classList.remove("disabled")}},fail:function fail(b){console.log(a,b);var d=document.querySelector("#item-"+c+"-"+a);if(d){d.remove();var e=document.getElementById("countbadge"),f=document.getElementById("itemcount");e.innerHTML=0<e.innerHTML?e.innerHTML-=1:e.innerHTML;f.innerHTML=0<f.innerHTML?f.innerHTML-=1:e.innerHTML;f.innerHTML=0==f.innerHTML?f.classList.add("hidden"):f.innerHTML;var g=d.dataset.price,h=document.getElementById("totalprice");h="undefined"==h?h=0:h;h.innerHTML-=g}}}])};a.deleteItem=q;var r=function(a,e){b.default.call([{methodname:"local_shopping_cart_add_item",args:{component:e,itemid:a},done:function done(b){b.component=e;b.id=a;b.userid=b.buyforuser;if(0==b.success){d.default.addNotification({message:"Cart is full",type:"danger"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert.alert-danger"),b=a[a.length-1];b.remove()},5e3)}else if(1==b.success){d.default.addNotification({message:b.itemname+" added to cart",type:"success"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert.alert-success"),b=a[a.length-1];b.remove()},5e3);c.default.renderForPromise("local_shopping_cart/shopping_cart_item",b).then(function(a){var c=a.html,d=document.querySelectorAll("[id^='litotalprice']");d.forEach(function(a){if(0==b.buyforuser||"litotalprice_cashier"===a.id){a.insertAdjacentHTML("beforeBegin",c)}});var g=document.querySelector("#btn-"+e+"-"+b.itemid);if(g){g.classList.add("disabled")}if(0!=b.buyforuser){return}document.getElementById("countbadge").innerHTML++;var i=document.getElementById("itemcount");i.innerHTML=(parseInt(i.innerHTML)||0)+1;i.classList.remove("hidden");var k=document.querySelectorAll("#totalprice");k.forEach(function(a){a.innerHTML=(parseInt(a.innerHTML)||0)+parseInt(b.price)});var l=document.querySelectorAll("#item-"+e+"-"+b.itemid+" .fa-trash-o");l.forEach(function(a){f(a)});clearInterval(j);h(b.expirationdate)}).catch(function(a){console.log(a)})}},fail:function fail(a){console.log("error",a)}}],!0)};a.addItem=r;function f(a){a.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var c=a.dataset.id.split("-"),d=c.pop(),e=c.pop(),f=a.dataset.userid;q(d,e,f)})}function g(b,c){var d=b,e,f;a.interval=j=setInterval(function(){e=parseInt(d/60,10);f=parseInt(d%60,10);e=10>e?"0"+e:e;f=10>f?"0"+f:f;c.textContent=e+":"+f;if(0>--d){p();clearInterval(j)}},1e3)}function h(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;if(j){clearInterval(j)}var b=0,c=Date.now("UTC");c=new Date().getTime()/1e3;if(a){b=a-c}if(0>=b){b=0;i.classList.add("hidden")}else if(0<b){i.classList.remove("hidden");g(b,i)}}});
//# sourceMappingURL=cart.min.js.map
