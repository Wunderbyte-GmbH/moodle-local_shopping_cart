define ("local_shopping_cart/cart",["exports","core/ajax","core/templates","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.addItem=a.deleteItem=a.deleteAllItems=a.reinit=a.init=a.buttoninit=a.reloadAllButtons=a.visbilityevent=a.interval=a.countdownelement=void 0;b=e(b);c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}var k=null;a.countdownelement=k;var l=null;a.interval=l;var m=!1;a.visbilityevent=m;var n=function(){var a=document.querySelectorAll("[id^=btn-]");a.forEach(function(a){a.classList.remove("disabled")})};a.reloadAllButtons=n;var o=function(a,b){if(!a){var e=document.querySelectorAll("[id^='btn-"+b+"']");e.forEach(function(a){var c=a.id.split(/[\s-]+/).pop();o(c,b)});return}var c=document.querySelector("#btn-"+b+"-"+a);if(!c||c.dataset.initialized){console.log("button already initialized",a);return}else{console.log("button not yet initialized",a)}var d=document.querySelector("#shopping_cart-cashiers-cart");if(!d){d=document.querySelector("#nav-shopping_cart-popover-container")}if(d){var f=d.querySelector("#item-"+b+"-"+a);if(f){c.classList.add("disabled")}}c.addEventListener("click",function(d){console.log("button clicked",a);if(c.classList.contains("disabled")){return}d.preventDefault();d.stopPropagation();t(a,b)});c.dataset.initialized=!0};a.buttoninit=o;var p=function(b){a.countdownelement=k=document.querySelector(".expirationdate");j(b);if(!1==m){var c=document.querySelectorAll("[id^=item-] .fa-trash-o");c.forEach(function(a){f(a)});document.addEventListener("visibilitychange",function(){a.visbilityevent=m=!0;if("visible"===document.visibilityState){q()}})}};a.init=p;var q=function(){n();b.default.call([{methodname:"local_shopping_cart_get_shopping_cart_items",args:{},done:function done(a){c.default.renderForPromise("local_shopping_cart/shopping_cart_items",a).then(function(b){var c=b.html;document.querySelector(".shopping-cart-items").remove();var d=document.querySelector("#nav-shopping_cart-popover-container .popover-region-content-container");d.insertAdjacentHTML("afterbegin",c);a.items.forEach(function(a){o(a.itemid,a.itemcomponent)});var e=document.querySelectorAll(".fa-trash-o");e.forEach(function(a){f(a)});var g=document.getElementById("itemcount");g.innerHTML=a.count;document.getElementById("countbadge").innerHTML=a.count;if(0<a.count){g.classList.remove("hidden")}else{g.classList.add("hidden")}j(a.expirationdate);return!0}).catch(function(a){console.log(a)})},fail:function fail(a){console.log("ex:"+a)}}])};a.reinit=q;var r=function(){b.default.call([{methodname:"local_shopping_cart_delete_all_items_from_cart",args:{},done:function done(){var a=document.querySelectorAll("[id^=item-]");a.forEach(function(a){if(a){a.remove()}});h();var b=document.getElementById("countbadge"),c=document.getElementById("itemcount");b.innerHTML=0;c.innerHTML=0;c.classList.add("hidden");var d=document.querySelectorAll("[id^=btn-].disabled");d.forEach(function(a){if(a){a.classList.remove("disabled")}})},fail:function fail(a){console.log(a)}}])};a.deleteAllItems=r;var s=function(a,c,d){b.default.call([{methodname:"local_shopping_cart_delete_item",args:{itemid:a,component:c,userid:d},done:function done(){var b=document.querySelectorAll("#item-"+c+"-"+a);b.forEach(function(a){if(a){a.remove()}});h();var d=document.getElementById("countbadge"),e=document.getElementById("itemcount");d.innerHTM=0<d.innerHTML?d.innerHTML-=1:d.innerHTML;e.innerHTML=0<e.innerHTML?e.innerHTML-=1:d.innerHTML;if(0==e.innerHTML){e.classList.add("hidden");clearInterval(l);j()}var f=document.querySelector("#btn-"+c+"-"+a);if(f){f.classList.remove("disabled");o(a,c)}},fail:function fail(b){console.log(a,b);var d=document.querySelector("#item-"+c+"-"+a);if(d){d.remove();var e=document.getElementById("countbadge"),f=document.getElementById("itemcount");e.innerHTML=0<e.innerHTML?e.innerHTML-=1:e.innerHTML;f.innerHTML=0<f.innerHTML?f.innerHTML-=1:e.innerHTML;f.innerHTML=0==f.innerHTML?f.classList.add("hidden"):f.innerHTML;var g=d.dataset.price;console.log("itemprice",g);h()}}}])};a.deleteItem=s;var t=function(a,e){b.default.call([{methodname:"local_shopping_cart_add_item",args:{component:e,itemid:a},done:function done(b){b.component=e;b.id=a;b.userid=b.buyforuser;console.log("buyforuser",b.buyforuser);if(1!=b.success){d.default.addNotification({message:"Cart is full",type:"danger"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert.alert-danger"),b=a[a.length-1];b.remove()},5e3)}else if(1==b.success){d.default.addNotification({message:b.itemname+" added to cart",type:"success"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert.alert-success"),b=a[a.length-1];b.remove()},5e3);c.default.renderForPromise("local_shopping_cart/shopping_cart_item",b).then(function(a){var c=a.html,d=document.querySelectorAll("[id^='litotalprice']");d.forEach(function(a){if(0==b.buyforuser||"litotalprice_cashier"===a.id){a.insertAdjacentHTML("beforeBegin",c)}});var i=document.querySelector("#btn-"+e+"-"+b.itemid);if(i){i.classList.add("disabled");i.removeEventListener("click",g)}var k=document.querySelectorAll("#item-"+e+"-"+b.itemid+" .fa-trash-o");k.forEach(function(a){console.log("add delete event",a);console.log("userid ",b.userid);f(a,b.userid)});h();if(0!=b.buyforuser){return}document.getElementById("countbadge").innerHTML++;var m=document.getElementById("itemcount");m.innerHTML=(parseInt(m.innerHTML)||0)+1;m.classList.remove("hidden");h();clearInterval(l);j(b.expirationdate)}).catch(function(a){console.log(a)})}},fail:function fail(a){console.log("error",a)}}],!0)};a.addItem=t;function f(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;if(0!=b){a.dataset.userid=b}a.addEventListener("click",g)}function g(){var a=this;console.log("item",a);var b=a.dataset.id.split("-");console.log("idarray",b);var c=b.pop(),d=b.pop(),e=parseInt(a.dataset.userid);if(!e){e=0}s(c,d,e)}function h(){var a=document.querySelector("#shopping_cart-cashiers-cart"),b=null,c=null,d=null;if(!a){a=document.querySelector("#nav-shopping_cart-popover-container");c=document.querySelector("div.checkoutgrid.checkout");console.log("1",c)}else{b=document.querySelector("#shopping_cart-cashiers-section")}var e=a.querySelectorAll("[id^=item-]"),f=0;e.forEach(function(a){if(a.dataset.price){f+=parseInt(a.dataset.price)}});var g=[];if(b){g=b.querySelectorAll(".totalprice")}else{g=a.querySelectorAll(".totalprice");if(c){d=c.querySelectorAll(".totalprice");if(d){d.forEach(function(a){a.innerHTML=f})}}}g.forEach(function(a){a.innerHTML=f})}function i(b,c){var d=b,e,f;a.interval=l=setInterval(function(){e=parseInt(d/60,10);f=parseInt(d%60,10);e=10>e?"0"+e:e;f=10>f?"0"+f:f;c.textContent=e+":"+f;if(0>--d){r();clearInterval(l)}},1e3)}function j(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;if(l){clearInterval(l)}var b=0,c=Date.now("UTC");c=new Date().getTime()/1e3;if(a){b=a-c}if(0>=b){b=0;k.classList.add("hidden")}else if(0<b){k.classList.remove("hidden");i(b,k)}}});
//# sourceMappingURL=cart.min.js.map
