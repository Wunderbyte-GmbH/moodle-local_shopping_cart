define ("local_shopping_cart/cart",["exports","core/ajax","core/templates"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.addItem=a.deleteItem=a.init=a.buttoninit=a.interval=void 0;b=d(b);c=d(c);function d(a){return a&&a.__esModule?a:{default:a}}var i=null;a.interval=i;a.buttoninit=function buttoninit(a,b){console.log("initialized",a,b);var c=document.querySelector("#btn-"+b+"-"+a);if(!c){return}c.querySelector(".loadJavascript").remove();var d=c.querySelector("span");if(d){d.classList.remove("hidden")}var e=document.querySelector("#nav-shopping_cart-popover-container");if(e){var f=e.querySelector("#item-"+b+"-"+a);if(f){c.classList.add("disabled")}}c.addEventListener("click",function(d){if(c.classList.contains("disabled")){return}d.preventDefault();d.stopPropagation();k(a,b)})};a.init=function init(){g();document.querySelectorAll(".fa-trash-o").forEach(function(a){e(a)})};var j=function(a,c){b.default.call([{methodname:"local_shopping_cart_delete_item",args:{itemid:a,component:c},done:function done(){console.log(a);var b=document.querySelectorAll("#item-"+c+"-"+a),d=b[0].dataset.price;b.forEach(function(a){if(a){a.remove()}});var e=document.querySelectorAll("#totalprice");e.forEach(function(a){a="undefined"==a?a=0:a;a.innerHTML-=d});var f=document.getElementById("countbadge"),g=document.getElementById("itemcount");f.innerHTM=0<f.innerHTML?f.innerHTML-=1:f.innerHTML;g.innerHTML=0<g.innerHTML?g.innerHTML-=1:f.innerHTML;g.innerHTML=0==g.innerHTML?g.classList.add("hidden"):g.innerHTML;var h=document.querySelector("#btn-"+c+"-"+a);if(h){h.classList.remove("disabled")}},fail:function fail(b){console.log(a,b);var d=document.querySelector("#item-"+c+"-"+a);if(d){d.remove();var e=document.getElementById("countbadge"),f=document.getElementById("itemcount");e.innerHTML=0<e.innerHTML?e.innerHTML-=1:e.innerHTML;f.innerHTML=0<f.innerHTML?f.innerHTML-=1:e.innerHTML;f.innerHTML=0==f.innerHTML?f.classList.add("hidden"):f.innerHTML;var g=d.dataset.price,h=document.getElementById("totalprice");h="undefined"==h?h=0:h;h.innerHTML-=g}}}])};a.deleteItem=j;var k=function(a,d){b.default.call([{methodname:"local_shopping_cart_add_item",args:{component:d,itemid:a},done:function done(b){b.component=d;b.id=a;c.default.renderForPromise("local_shopping_cart/shopping_cart_item",b).then(function(a){var c=a.html,f=document.getElementById("litotalprice");f.insertAdjacentHTML("beforeBegin",c);document.getElementById("countbadge").innerHTML++;var j=document.getElementById("itemcount");j.innerHTML=(parseInt(j.innerHTML)||0)+1;j.classList.remove("hidden");var k=document.getElementById("totalprice");k.innerHTML=(parseInt(k.innerHTML)||0)+parseInt(b.price);var l=document.querySelector("#item-"+d+"-"+b.itemid+" .fa-trash-o");e(l);clearInterval(i);h(b.expirationdate);g();var m=document.querySelector("#btn-"+d+"-"+b.itemid);if(m){m.classList.add("disabled")}})},fail:function fail(a){console.log("error",a)}}],!0)};a.addItem=k;function e(a){a.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();console.log("delete clicked",a.dataset.id);var c=a.dataset.id.split("-"),d=c.pop(),e=c.pop();j(d,e)})}function f(b,c,d){var e=c,f,g;a.interval=i=setInterval(function(){f=parseInt(e/60,10);g=parseInt(e%60,10);f=10>f?"0"+f:f;g=10>g?"0"+g:g;d.textContent=f+":"+g;if(0>--e||!b){e=0;clearInterval(i)}},1e3)}function g(){document.querySelectorAll(".expirationdate").forEach(function(a){var b=0,c=Date.now("UTC");c=new Date().getTime()/1e3;b=a.dataset.expirationdate-c;if(0>b){b=0}f(1,b,a)})}function h(a){document.querySelectorAll(".expirationdate").forEach(function(b){b.dataset.expirationdate=a})}});
//# sourceMappingURL=cart.min.js.map
