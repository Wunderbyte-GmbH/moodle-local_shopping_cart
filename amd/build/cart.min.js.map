{"version":3,"sources":["../src/cart.js"],"names":["init","document","querySelectorAll","forEach","listitem","console","log","dataset","expirationdate","id","setTimer","item","addDeleteevent","querySelector","addEventListener","event","preventDefault","stopPropagation","addItem","deleteItem","Ajax","call","methodname","args","done","remove","itemcount1","getElementById","itemcount2","innerHTML","classList","add","itemprice","price","total","fail","ex","data","html","name","lastElem","insertAdjacentHTML","totalprice","parseInt","split","pop","startTimer","duration","display","timer","minutes","seconds","setInterval","textContent","delta","now","Date","getTime"],"mappings":"4KAqBA,uD,OAMoB,QAAPA,CAAAA,IAAO,EAAM,CACtBC,QAAQ,CAACC,gBAAT,CAA0B,iCAA1B,EAA6DC,OAA7D,CAAqE,SAAAC,CAAQ,CAAI,CAE7EC,OAAO,CAACC,GAAR,CAAYF,CAAQ,CAACG,OAAT,CAAiBC,cAAjB,CAAkC,QAAlC,CAA6CJ,CAAQ,CAACG,OAAT,CAAiBE,EAA1E,EACAC,CAAQ,CAACN,CAAQ,CAACG,OAAT,CAAiBC,cAAlB,CAAkCJ,CAAQ,CAACG,OAAT,CAAiBE,EAAnD,CACX,CAJD,EAKAR,QAAQ,CAACC,gBAAT,CAA0B,aAA1B,EAAyCC,OAAzC,CAAiD,SAAAQ,CAAI,CAAI,CACrDC,CAAc,CAACD,CAAD,CACjB,CAFD,EAIAV,QAAQ,CAACY,aAAT,CAAuB,6DAAvB,EAAsFC,gBAAtF,CAAuG,OAAvG,CAAgH,SAAAC,CAAK,CAAI,CACrHA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GACAC,CAAO,EACV,CAJD,CAKH,C,CAGM,GAAMC,CAAAA,CAAU,CAAG,SAACV,CAAD,CAAQ,CAC9BW,UAAKC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,iCADL,CAEPC,IAAI,CAAE,CACF,GAAMd,CADJ,CAFC,CAKPe,IAAI,CAAE,eAAW,CAEbnB,OAAO,CAACC,GAAR,CAAYG,CAAZ,EACA,GAAIE,CAAAA,CAAI,CAAGV,QAAQ,CAACY,aAAT,CAAuB,SAAWJ,CAAlC,CAAX,CACA,GAAIE,CAAJ,CAAU,CACNA,CAAI,CAACc,MAAL,GADM,GAEFC,CAAAA,CAAU,CAAGzB,QAAQ,CAAC0B,cAAT,CAAwB,YAAxB,CAFX,CAGFC,CAAU,CAAG3B,QAAQ,CAAC0B,cAAT,CAAwB,WAAxB,CAHX,CAIND,CAAU,CAACG,SAAX,CAA8C,CAAvB,CAAAH,CAAU,CAACG,SAAX,CAA2BH,CAAU,CAACG,SAAX,EAAwB,CAAnD,CAAuDH,CAAU,CAACG,SAAzF,CACAD,CAAU,CAACC,SAAX,CAA8C,CAAvB,CAAAD,CAAU,CAACC,SAAX,CAA2BD,CAAU,CAACC,SAAX,EAAwB,CAAnD,CAAuDH,CAAU,CAACG,SAAzF,CACAD,CAAU,CAACC,SAAX,CAA+C,CAAxB,EAAAD,CAAU,CAACC,SAAX,CAA4BD,CAAU,CAACE,SAAX,CAAqBC,GAArB,CAAyB,QAAzB,CAA5B,CAAiEH,CAAU,CAACC,SAAnG,CANM,GAOFG,CAAAA,CAAS,CAAGrB,CAAI,CAACJ,OAAL,CAAa0B,KAPvB,CAQFC,CAAK,CAAGjC,QAAQ,CAAC0B,cAAT,CAAwB,YAAxB,CARN,CASNO,CAAK,CAAY,WAAT,EAAAA,CAAK,CAAkB,CAAlB,CAAsBA,CAAnC,CACAA,CAAK,CAACL,SAAN,EAAmBG,CACtB,CACJ,CArBM,CAsBPG,IAAI,CAAE,cAASC,CAAT,CAAa,CAEf/B,OAAO,CAACC,GAAR,CAAYG,CAAZ,CAAgB2B,CAAhB,EACA,GAAIzB,CAAAA,CAAI,CAAIV,QAAQ,CAACY,aAAT,CAAuB,SAAWJ,CAAlC,CAAZ,CACA,GAAIE,CAAJ,CAAU,CACNA,CAAI,CAACc,MAAL,GADM,GAEFC,CAAAA,CAAU,CAAGzB,QAAQ,CAAC0B,cAAT,CAAwB,YAAxB,CAFX,CAGFC,CAAU,CAAG3B,QAAQ,CAAC0B,cAAT,CAAwB,WAAxB,CAHX,CAIND,CAAU,CAACG,SAAX,CAA8C,CAAvB,CAAAH,CAAU,CAACG,SAAX,CAA2BH,CAAU,CAACG,SAAX,EAAwB,CAAnD,CAAuDH,CAAU,CAACG,SAAzF,CACAD,CAAU,CAACC,SAAX,CAA8C,CAAvB,CAAAD,CAAU,CAACC,SAAX,CAA2BD,CAAU,CAACC,SAAX,EAAwB,CAAnD,CAAuDH,CAAU,CAACG,SAAzF,CACAD,CAAU,CAACC,SAAX,CAA+C,CAAxB,EAAAD,CAAU,CAACC,SAAX,CAA4BD,CAAU,CAACE,SAAX,CAAqBC,GAArB,CAAyB,QAAzB,CAA5B,CAAiEH,CAAU,CAACC,SAAnG,CANM,GAOFG,CAAAA,CAAS,CAAGrB,CAAI,CAACJ,OAAL,CAAa0B,KAPvB,CAQFC,CAAK,CAAGjC,QAAQ,CAAC0B,cAAT,CAAwB,YAAxB,CARN,CASNO,CAAK,CAAY,WAAT,EAAAA,CAAK,CAAkB,CAAlB,CAAsBA,CAAnC,CACAA,CAAK,CAACL,SAAN,EAAmBG,CACtB,CACJ,CAtCM,CAAD,CAAV,CAwCH,CAzCM,C,eA2CA,GAAMd,CAAAA,CAAO,CAAG,UAAM,CACzBE,UAAKC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,8BADL,CAEPC,IAAI,CAAE,CACF,GAAM,GADJ,CAFC,CAKPC,IAAI,CAAE,cAASa,CAAT,CAAe,IACdC,CAAAA,CAAI,CAAG,iBAAkBD,CAAI,CAAC5B,EAAvB,CAA4B,qCAA5B,CAAgE4B,CAAI,CAACJ,KAArE,CAA6E,iBAA7E,CAA+FI,CAAI,CAACE,IAApG,CACR,2BADQ,CACoBF,CAAI,CAAC7B,cADzB,CAC0C,eAD1C,CAC0D6B,CAAI,CAAC5B,EAD/D,sFAEoE4B,CAAI,CAACE,IAFzE,iDAG+BF,CAAI,CAACJ,KAHpC,0EAI4CI,CAAI,CAAC5B,EAJjD,wGAKwE4B,CAAI,CAAC5B,EAL7E,sBADO,CAQb+B,CAAQ,CAAGvC,QAAQ,CAAC0B,cAAT,CAAwB,cAAxB,CARE,CASjBa,CAAQ,CAACC,kBAAT,CAA4B,aAA5B,CAA2CH,CAA3C,EATiB,GAUbZ,CAAAA,CAAU,CAAGzB,QAAQ,CAAC0B,cAAT,CAAwB,YAAxB,CAVA,CAWbC,CAAU,CAAG3B,QAAQ,CAAC0B,cAAT,CAAwB,WAAxB,CAXA,CAYjBC,CAAU,CAACE,SAAX,CAAqBL,MAArB,CAA4B,QAA5B,EACAC,CAAU,CAACG,SAAX,GACAD,CAAU,CAACC,SAAX,GACA,GAAIa,CAAAA,CAAU,CAAGzC,QAAQ,CAAC0B,cAAT,CAAwB,YAAxB,CAAjB,CACAe,CAAU,CAACb,SAAX,CAAuB,CAACc,QAAQ,CAACD,CAAU,CAACb,SAAZ,CAAR,EAAkC,CAAnC,EAAwCc,QAAQ,CAACN,CAAI,CAACJ,KAAN,CAAvE,CACArB,CAAc,CAACX,QAAQ,CAACY,aAAT,CAAuB,SAAWwB,CAAI,CAAC5B,EAAhB,CAAqB,cAA5C,CAAD,CAAd,CACAC,CAAQ,CAAC2B,CAAI,CAAC7B,cAAN,CAAsB6B,CAAI,CAAC5B,EAA3B,CACX,CAxBM,CAyBP0B,IAAI,CAAE,cAASC,CAAT,CAAa,CAEf/B,OAAO,CAACC,GAAR,CAAY8B,CAAZ,CACH,CA5BM,CAAD,CAAV,IA8BH,CA/BM,C,YAqCP,QAASxB,CAAAA,CAAT,CAAwBD,CAAxB,CAA8B,CAC1BA,CAAI,CAACG,gBAAL,CAAsB,OAAtB,CAA+B,SAAAC,CAAK,CAAI,CACpCA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GACA,GAAIR,CAAAA,CAAE,CAAGE,CAAI,CAACJ,OAAL,CAAaE,EAAb,CAAgBmC,KAAhB,CAAsB,GAAtB,EAA2BC,GAA3B,EAAT,CACA1B,CAAU,CAACV,CAAD,CACb,CALD,CAMH,CAQD,QAASqC,CAAAA,CAAT,CAAoBC,CAApB,CAA8BC,CAA9B,CAAuCvC,CAAvC,CAA2C,CACvC,GAAIwC,CAAAA,CAAK,CAAGF,CAAZ,CAAsBG,CAAtB,CAA+BC,CAA/B,CACAC,WAAW,CAAC,UAAY,CACpBF,CAAO,CAAGP,QAAQ,CAACM,CAAK,CAAG,EAAT,CAAa,EAAb,CAAlB,CACAE,CAAO,CAAGR,QAAQ,CAACM,CAAK,CAAG,EAAT,CAAa,EAAb,CAAlB,CAEAC,CAAO,CAAa,EAAV,CAAAA,CAAO,CAAQ,IAAMA,CAAd,CAAwBA,CAAzC,CACAC,CAAO,CAAa,EAAV,CAAAA,CAAO,CAAQ,IAAMA,CAAd,CAAwBA,CAAzC,CAEAH,CAAO,CAACK,WAAR,CAAsBH,CAAO,CAAG,GAAV,CAAgBC,CAAtC,CAEA,GAAc,CAAV,GAAEF,CAAN,CAAiB,CACbA,CAAK,CAAG,CAAR,CACA9B,CAAU,CAACV,CAAD,CACb,CACJ,CAbU,CAaR,GAbQ,CAcd,CAOD,QAASC,CAAAA,CAAT,CAAkBF,CAAlB,CAAkCC,CAAlC,CAAsC,IAC9B6C,CAAAA,CAAK,CAAG,CADsB,CAE9BC,CAAG,CAAGC,IAAI,CAACD,GAAL,CAAS,KAAT,CAFwB,CAGlCA,CAAG,CAAI,GAAIC,CAAAA,IAAJ,EAAD,CAAaC,OAAb,GAAyB,GAA/B,CACAH,CAAK,CAAI9C,CAAc,CAAG+C,CAA1B,CACA,GAAY,CAAR,CAAAD,CAAJ,CAAe,CACXA,CAAK,CAAG,CACX,CACD,GAAIN,CAAAA,CAAO,CAAG/C,QAAQ,CAACY,aAAT,CAAuB,cAAgBJ,CAAvC,CAAd,CACA,GAAIuC,CAAJ,CAAa,CACTF,CAAU,CAACQ,CAAD,CAAQN,CAAR,CAAiBvC,CAAjB,CACb,CACJ,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_shopping_cart\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\n\n/**\n * Gets called from mustache template.\n *\n */\nexport const init = () => {\n    document.querySelectorAll('.shopping-cart-items [id^=item]').forEach(listitem => {\n        // eslint-disable-next-line no-console\n        console.log(listitem.dataset.expirationdate + \" asd a\" + listitem.dataset.id);\n        setTimer(listitem.dataset.expirationdate, listitem.dataset.id);\n    });\n    document.querySelectorAll('.fa-trash-o').forEach(item => {\n        addDeleteevent(item);\n    });\n\n    document.querySelector('#nav-shopping_cart-popover-container .btn-primary.addrandom').addEventListener('click', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        addItem();\n    });\n};\n\n\nexport const deleteItem = (id) => {\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_item\",\n        args: {\n            'id': id,\n        },\n        done: function() {\n            // eslint-disable-next-line no-console\n            console.log(id);\n            let item = document.querySelector('#item-' + id);\n            if (item) {\n                item.remove();\n                let itemcount1 = document.getElementById(\"countbadge\");\n                let itemcount2 = document.getElementById(\"itemcount\");\n                itemcount1.innerHTML = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML == 0 ? itemcount2.classList.add(\"hidden\") : itemcount2.innerHTML;\n                let itemprice = item.dataset.price;\n                let total = document.getElementById('totalprice');\n                total = total == \"undefined\" ? 0 : total;\n                total.innerHTML -= itemprice;\n            }\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(id, ex);\n            let item =  document.querySelector('#item-' + id);\n            if (item) {\n                item.remove();\n                let itemcount1 = document.getElementById(\"countbadge\");\n                let itemcount2 = document.getElementById(\"itemcount\");\n                itemcount1.innerHTML = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML == 0 ? itemcount2.classList.add(\"hidden\") : itemcount2.innerHTML;\n                let itemprice = item.dataset.price;\n                let total = document.getElementById('totalprice');\n                total = total == \"undefined\" ? 0 : total;\n                total.innerHTML -= itemprice;\n            }\n        },\n    }]);\n};\n\nexport const addItem = () => {\n    Ajax.call([{\n        methodname: \"local_shopping_cart_add_item\",\n        args: {\n            'id': '1',\n        },\n        done: function(data) {\n           let html = '<li id=\"item-' + data.id + '\" class=\"clearfix\" data-price=\"' + data.price + '\" data-name=\"' + data.name\n            + '\" data-expirationdate=\"' + data.expirationdate + '\" data-id=\"' + data.id + '\">' +\n            '<span class=\"item-name\"><i class=\"fa fa-futbol-o\" aria-hidden=\"true\"></i>' + data.name + '</span>' +\n            '<span class=\"item-price pull-right\">' + data.price + '€</span><br>' +\n           '<span class=\"item-time pl-3\">[<span id=\"time-item-' + data.id + '\"></span>]</span>' +\n            '<span class=\"pull-right\"><i class=\"fa fa-trash-o lighter-text\" data-id=\"item-' + data.id + '\"></i></span>' +\n            '</li>';\n            let lastElem = document.getElementById('litotalprice');\n            lastElem.insertAdjacentHTML('beforeBegin', html);\n            let itemcount1 = document.getElementById(\"countbadge\");\n            let itemcount2 = document.getElementById(\"itemcount\");\n            itemcount2.classList.remove(\"hidden\");\n            itemcount1.innerHTML ++;\n            itemcount2.innerHTML ++;\n            let totalprice = document.getElementById('totalprice');\n            totalprice.innerHTML = (parseInt(totalprice.innerHTML) || 0) + parseInt(data.price);\n            addDeleteevent(document.querySelector('#item-' + data.id + ' .fa-trash-o'));\n            setTimer(data.expirationdate, data.id);\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(ex);\n        }\n    }], true);\n};\n\n/**\n * Delete Event.\n * @param {*} item\n */\nfunction addDeleteevent(item) {\n    item.addEventListener('click', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        let id = item.dataset.id.split('-').pop();\n        deleteItem(id);\n    });\n}\n\n/**\n * Start the timer.\n * @param {int} duration\n * @param {int} display\n * @param {int} id\n */\nfunction startTimer(duration, display, id) {\n    var timer = duration, minutes, seconds;\n    setInterval(function () {\n        minutes = parseInt(timer / 60, 10);\n        seconds = parseInt(timer % 60, 10);\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        display.textContent = minutes + \":\" + seconds;\n\n        if (--timer < 0) {\n            timer = 0;\n            deleteItem(id);\n        }\n    }, 1000);\n}\n\n/**\n * Set the timer.\n * @param {int} expirationdate\n * @param {int} id\n */\nfunction setTimer(expirationdate, id) {\n    let delta = 0;\n    let now = Date.now('UTC');\n    now = (new Date()).getTime() / 1000;\n    delta = (expirationdate - now);\n    if (delta < 0) {\n        delta = 0;\n    }\n    let display = document.querySelector('#time-item-' + id);\n    if (display) {\n        startTimer(delta, display, id);\n    }\n}\n"],"file":"cart.min.js"}