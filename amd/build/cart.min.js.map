{"version":3,"sources":["../src/cart.js"],"names":["countdownelement","interval","visbilityevent","reloadAllButtons","addtocartbuttons","document","querySelectorAll","forEach","button","classList","remove","buttoninit","id","component","buttons","number","split","pop","addtocartbutton","querySelector","dataset","initialized","shoppingcart","cartitem","add","addEventListener","event","console","log","contains","preventDefault","stopPropagation","addItem","init","expirationdate","initTimer","items","item","addDeleteevent","visibilityState","reinit","updateTotalPrice","Ajax","call","methodname","args","done","data","Templates","renderForPromise","then","html","container","insertAdjacentHTML","itemid","itemcomponent","deleteaction","itemcount","getElementById","innerHTML","count","catch","e","fail","ex","deleteAllItems","itemcount1","itemcount2","btn","deleteItem","userid","innerHTM","clearInterval","itemprice","price","oncashier","window","location","href","indexOf","buyforuser","success","Notification","addNotification","message","type","setTimeout","notificationslist","notificatonelement","length","itemname","lastElements","lastElem","removeEventListener","deleteEvent","badge","parseInt","usecredit","labelareas","element","checkbox","checked","usecreditclass","initialtotal","cashierssection","checkoutcart","checkouttotals","totals","total","paymentbutton","currency","cost","dealWithZeroPrice","checkboxid","Math","random","toString","slice","child","lastElementChild","removeChild","target","confirmZeroPriceCheckoutModal","idarray","startTimer","duration","display","timer","minutes","seconds","setInterval","textContent","delta","now","Date","getTime","key","strings","ModalFactory","create","types","SAVE_CANCEL","modal","setTitle","setBody","setSaveButtonText","getRoot","on","ModalEvents","save","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_shopping_cart\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nimport {confirmPayment} from 'local_shopping_cart/cachier';\n\nimport {\n    get_strings as getStrings\n        }\n        from 'core/str';\n\nexport var countdownelement = null;\nexport var interval = null;\nexport var visbilityevent = false;\n\nexport const reloadAllButtons = () => {\n    const addtocartbuttons = document.querySelectorAll('[id^=btn-]');\n    addtocartbuttons.forEach(button => {\n        button.classList.remove('disabled');\n    });\n};\n\nexport const buttoninit = (id, component) => {\n\n    // If there is no id, we browse the whole document and init all buttons individually.\n    if (!id) {\n\n        const buttons = document.querySelectorAll(\"[id^='btn-\" + component + \"']\");\n\n        buttons.forEach(button => {\n            // We have to get only the last part of the id, the number.\n            const number = button.id.split(/[\\s-]+/).pop();\n            buttoninit(number, component);\n        });\n        return;\n    }\n\n    // First we get the button and delete the helper-span to secure js loading.\n    const addtocartbutton = document.querySelector('#btn-' + component + '-' + id);\n\n    // If we don't find the button, we abort.\n    if (!addtocartbutton\n        || addtocartbutton.dataset.initialized) {\n        return;\n    }\n\n    // Make sure item is not yet in shopping cart. If so, add disabled class.\n\n\n    let shoppingcart = document.querySelector('#shopping_cart-cashiers-cart');\n\n    if (!shoppingcart) {\n        shoppingcart = document.querySelector('#nav-shopping_cart-popover-container');\n    }\n\n    if (shoppingcart) {\n        const cartitem = shoppingcart.querySelector('#item-' + component + '-' + id);\n        if (cartitem) {\n            addtocartbutton.classList.add('disabled');\n        }\n    }\n    // Add click eventlistern to oneself.\n    addtocartbutton.addEventListener('click', event => {\n\n         // eslint-disable-next-line no-console\n         console.log('button clicked', id);\n\n        // If we find the disabled class, the click event is aborted.\n        if (addtocartbutton.classList.contains('disabled')) {\n            return;\n        }\n        event.preventDefault();\n        event.stopPropagation();\n        addItem(id, component);\n    });\n\n    addtocartbutton.dataset.initialized = true;\n};\n\n/**\n *\n * @param {*} expirationdate\n */\n\n export const init = (expirationdate) => {\n    countdownelement = document.querySelector('.expirationdate');\n    initTimer(expirationdate);\n    if (visbilityevent == false) {\n        let items = document.querySelectorAll('[id^=item-] .fa-trash-o');\n        items.forEach(item => {\n            addDeleteevent(item);\n        });\n        document.addEventListener(\"visibilitychange\", function() {\n            visbilityevent = true;\n            if (document.visibilityState === 'visible') {\n                reinit();\n            }\n        });\n    }\n    updateTotalPrice();\n};\n\nexport const reinit = () => {\n    reloadAllButtons();\n    Ajax.call([{\n        methodname: \"local_shopping_cart_get_shopping_cart_items\",\n        args: {\n        },\n        done: function(data) {\n            Templates.renderForPromise('local_shopping_cart/shopping_cart_items', data).then(({html}) => {\n                document.querySelector('.shopping-cart-items').remove();\n                let container = document.querySelector('#nav-shopping_cart-popover-container .shopping-cart-items-container');\n                container.insertAdjacentHTML('afterbegin', html);\n                data.items.forEach(item => {\n                    buttoninit(item.itemid, item.itemcomponent);\n                });\n                let deleteaction = document.querySelectorAll('.fa-trash-o');\n                deleteaction.forEach(item => {\n                    addDeleteevent(item);\n                });\n                let itemcount = document.getElementById(\"itemcount\");\n                itemcount.innerHTML = data.count;\n                document.getElementById(\"countbadge\").innerHTML = data.count;\n                if (data.count > 0) {\n                    itemcount.classList.remove(\"hidden\");\n                } else {\n                    itemcount.classList.add(\"hidden\");\n                }\n                initTimer(data.expirationdate);\n\n                return true;\n            }).catch((e) => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(\"ex:\" + ex);\n        },\n    }]);\n};\n\nexport const deleteAllItems = () => {\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_all_items_from_cart\",\n        args: {\n        },\n        done: function() {\n            let item = document.querySelectorAll('[id^=item-]');\n            item.forEach(item => {\n                if (item) {\n                    item.remove();\n                }\n            });\n\n            updateTotalPrice();\n\n            let itemcount1 = document.getElementById(\"countbadge\");\n            let itemcount2 = document.getElementById(\"itemcount\");\n\n            itemcount1.innerHTML = 0;\n            itemcount2.innerHTML = 0;\n            itemcount2.classList.add(\"hidden\");\n\n            // Make sure addtocartbutton active againe once the item is removed from the shopping cart.\n            const addtocartbutton = document.querySelectorAll('[id^=btn-].disabled');\n            addtocartbutton.forEach(btn => {\n                if (btn) {\n                    btn.classList.remove('disabled');\n                }\n            });\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(ex);\n        },\n    }]);\n};\n\nexport const deleteItem = (id, component, userid) => {\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_item\",\n        args: {\n            'itemid': id,\n            'component': component,\n            'userid': userid\n        },\n        done: function() {\n\n            // We might display the item more often than once.\n            let items = document.querySelectorAll('#item-' + component + '-' + id);\n\n            items.forEach(item => {\n                if (item) {\n                    item.remove();\n                }\n            });\n\n            updateTotalPrice(userid);\n\n            let itemcount1 = document.getElementById(\"countbadge\");\n            let itemcount2 = document.getElementById(\"itemcount\");\n\n            itemcount1.innerHTM = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\n            itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\n\n            // If we have only one item left, we set back the expiration date.\n            if (itemcount2.innerHTML == 0) {\n                itemcount2.classList.add(\"hidden\");\n\n                // We clear the countdown and set back the timer.\n                clearInterval(interval);\n                initTimer();\n            }\n\n            // Make sure addtocartbutton active againe once the item is removed from the shopping cart.\n            const addtocartbutton = document.querySelector('#btn-' + component + '-' + id);\n            if (addtocartbutton) {\n                addtocartbutton.classList.remove('disabled');\n                buttoninit(id, component);\n            }\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(id, ex);\n            let item = document.querySelector('#item-' + component + '-' + id);\n            if (item) {\n                item.remove();\n                let itemcount1 = document.getElementById(\"countbadge\");\n                let itemcount2 = document.getElementById(\"itemcount\");\n                itemcount1.innerHTML = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML == 0 ? itemcount2.classList.add(\"hidden\") : itemcount2.innerHTML;\n                let itemprice = item.dataset.price;\n\n                // eslint-disable-next-line no-console\n                console.log('itemprice', itemprice);\n\n                updateTotalPrice(userid);\n            }\n        },\n    }]);\n};\n\nexport const addItem = (id, component) => {\n\n    const oncashier = window.location.href.indexOf(\"cashier.php\");\n\n    let userid = 0;\n    if (oncashier > 0) {\n        userid = -1;\n    }\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_add_item\",\n        args: {\n            'component': component,\n            'itemid': id,\n            'userid': userid\n        },\n        done: function(data) {\n            data.component = component;\n            data.id = id;\n            data.userid = data.buyforuser; // For the mustache template, we need to obey structure.\n\n            if (data.success != 1) {\n                Notification.addNotification({\n                    message: \"Cart is full\",\n                    type: \"danger\"\n                });\n                setTimeout(() => {\n                    let notificationslist = document.querySelectorAll('#user-notifications div.alert.alert-danger');\n                    const notificatonelement = notificationslist[notificationslist.length - 1];\n                    notificatonelement.remove();\n                }, 5000);\n                return;\n            } else if (data.success == 1) {\n                Notification.addNotification({\n                    message: data.itemname + \" added to cart\",\n                    type: \"success\"\n                });\n\n                setTimeout(() => {\n                    let notificationslist = document.querySelectorAll('#user-notifications div.alert.alert-success');\n\n                    const notificatonelement = notificationslist[notificationslist.length - 1];\n\n                    notificatonelement.remove();\n                }, 5000);\n\n                Templates.renderForPromise('local_shopping_cart/shopping_cart_item', data).then(({html}) => {\n                    let lastElements = document.querySelectorAll(\"[id^='liinitialtotal']\");\n                    lastElements.forEach(lastElem => {\n\n                        // eslint-disable-next-line no-console\n                        console.log('found li', lastElem);\n\n                        // If we buy for a user, we only want to interact with the cashiers section.\n                        if ((data.buyforuser == 0)\n                            || (lastElem.id === \"liinitialtotal_cashier\")) {\n                            lastElem.insertAdjacentHTML('beforeBegin', html);\n                        }\n                    });\n\n                    // Make sure addtocartbutton is disabled once the item is in the shopping cart.\n                    const addtocartbutton = document.querySelector('#btn-' + component + '-' + data.itemid);\n                    if (addtocartbutton) {\n                        addtocartbutton.classList.add('disabled');\n                        addtocartbutton.removeEventListener('click', deleteEvent);\n                    }\n\n                    let items = document.querySelectorAll('#item-' + component + '-' + data.itemid + ' .fa-trash-o');\n                    items.forEach(item => {\n                        addDeleteevent(item, data.userid);\n                    });\n\n                    updateTotalPrice(data.userid);\n\n                    // If we buy for a user, we don't have to do the navbar stuff below.\n                    if (data.buyforuser != 0) {\n                        return;\n                    }\n                    document.getElementById(\"countbadge\").innerHTML++;\n                    const badge = document.getElementById(\"itemcount\");\n                    badge.innerHTML = (parseInt(badge.innerHTML) || 0) + 1;\n                    badge.classList.remove('hidden');\n                    updateTotalPrice(data.userid);\n                    clearInterval(interval);\n                    initTimer(data.expirationdate);\n                    return;\n                }).catch((e) => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n            }\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log('error', ex);\n        }\n    }], true);\n};\n\n/**\n *\n * @param {*} userid\n * @param {*} usecredit\n */\nexport const updateTotalPrice = (userid = 0, usecredit = true) => {\n\n    // eslint-disable-next-line no-console\n    console.log('updatetotalprice');\n\n    // First, get the state of usecredit.\n    const oncashier = window.location.href.indexOf(\"cashier.php\");\n\n    let labelareas = null;\n    if (oncashier > 0) {\n        labelareas = document.querySelectorAll('div.sc_price_label');\n    } else {\n        labelareas = document.querySelectorAll('li.sc_price_label');\n    }\n\n    labelareas.forEach(element => {\n\n        // eslint-disable-next-line no-console\n        console.log(element);\n\n        // First we update the userid, if possible.\n        userid = element.dataset.userid ? element.dataset.userid : userid;\n\n        const checkbox = element.querySelector('input.usecredit-checkbox');\n\n        if (checkbox) {\n            if (checkbox.checked) {\n\n                // eslint-disable-next-line no-console\n                console.log('checked', checkbox.checked);\n                usecredit = checkbox.checked;\n            } else {\n                usecredit = 0;\n            }\n        }\n    });\n\n    usecredit = usecredit ? 1 : 0;\n\n    // eslint-disable-next-line no-console\n    console.log('usecredit before ajax', usecredit);\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_get_price\",\n        args: {\n            userid,\n            usecredit\n        },\n        done: function(data) {\n\n            // eslint-disable-next-line no-console\n            console.log(data);\n\n            // We take the usecredit value we receive from the server.\n            if (data.usecredit == 1) {\n                data.usecreditclass = 'checked';\n            } else {\n                data.usecreditclass = '';\n            }\n\n            const initialtotal = data.initialtotal;\n\n            let shoppingcart = document.querySelector('#shopping_cart-cashiers-cart');\n            let cashierssection = null;\n            let checkoutcart = null;\n            let checkouttotals = null;\n\n            if (!shoppingcart) {\n                shoppingcart = document.querySelector('#nav-shopping_cart-popover-container');\n                checkoutcart = document.querySelector('div.checkoutgrid.checkout');\n                // eslint-disable-next-line no-console\n                console.log('1', checkoutcart);\n            } else {\n                cashierssection = document.querySelector('#shopping_cart-cashiers-section');\n            }\n\n            let totals = [];\n            if (cashierssection) {\n                totals = cashierssection.querySelectorAll('.initialtotal');\n            } else {\n                // First we add the total price from navbar.\n                totals = shoppingcart.querySelectorAll('.initialtotal');\n\n                // If we are on the checkout site, we deal with the totals there separately.\n                if (checkoutcart) {\n                    checkouttotals = checkoutcart.querySelectorAll('.initialtotal');\n\n                    if (checkouttotals) {\n                        checkouttotals.forEach(total => {\n                            total.innerHTML = initialtotal;\n                        });\n                    }\n                }\n            }\n\n            let paymentbutton = document.querySelector(\".shopping_cart_payment_region button\");\n\n            if (paymentbutton) {\n\n                const price = data.price;\n                const currency = data.currency;\n\n                // eslint-disable-next-line no-console\n                console.log(\"paymentbutton\", price, currency);\n\n                paymentbutton.dataset.cost = price + \" \" + currency;\n\n                if (price == 0) {\n                    // eslint-disable-next-line no-console\n                    console.log('price is 0');\n                    paymentbutton.addEventListener('click', dealWithZeroPrice);\n                } else {\n                    // eslint-disable-next-line no-console\n                    console.log('price is not 0');\n                    paymentbutton.removeEventListener('click', dealWithZeroPrice);\n                }\n            }\n\n            // Run through the list of total prices and set them to the right one.\n            totals.forEach(total => {\n                total.innerHTML = initialtotal;\n            });\n\n            data.checkboxid = Math.random().toString(36).slice(2, 5);\n\n            Templates.renderForPromise('local_shopping_cart/price_label', data).then(({html}) => {\n                labelareas.forEach(element => {\n                    // First, clean all children.\n                    let child = element.lastElementChild;\n                    while (child) {\n                        element.removeChild(child);\n                        child = element.lastElementChild;\n                    }\n                    element.insertAdjacentHTML(\"afterbegin\", html);\n\n                    const checkbox = element.querySelector('input.usecredit-checkbox');\n\n                    if (checkbox) {\n                        checkbox.addEventListener('change', event => {\n\n                            // eslint-disable-next-line no-console\n                            console.log(event);\n\n                            updateTotalPrice(userid);\n                        });\n                    }\n\n                });\n                return true;\n            }).catch((e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            }));\n\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log('error', ex);\n        }\n    }], true);\n};\n\n/**\n *\n * @param {*} event\n */\nfunction dealWithZeroPrice(event) {\n\n    // eslint-disable-next-line no-console\n    console.log('onlymyclickcounts');\n\n        event.stopPropagation();\n        event.preventDefault();\n        // eslint-disable-next-line no-console\n        console.log('onlymyclickcounts', event.target);\n\n        confirmZeroPriceCheckoutModal(event.target);\n}\n\n/**\n * Delete Event.\n * @param {HTMLElement} item\n * @param {int} userid\n */\nfunction addDeleteevent(item, userid = 0) {\n    if (userid != 0) {\n        item.dataset.userid = userid;\n    }\n    item.addEventListener('click', deleteEvent);\n}\n\n/**\n * Function called in listener,\n * @param {HTMLElement} item\n */\nfunction deleteEvent() {\n\n        const item = this;\n        // eslint-disable-next-line no-console\n        console.log('item', item);\n        // Item comes as #item-booking-213123.\n        const idarray = item.dataset.id.split('-');\n\n        // eslint-disable-next-line no-console\n        console.log('idarray', idarray);\n        // First pop gets the id.\n        const id = idarray.pop();\n        // Second pop gets the component.\n        const component = idarray.pop();\n        let userid = parseInt(item.dataset.userid);\n\n        if (!userid) {\n            userid = 0;\n        }\n\n        deleteItem(id, component, userid);\n    }\n\n/**\n * Start the timer.\n *\n * @param {integer} duration\n * @param {integer} display\n */\nfunction startTimer(duration, display) {\n\n    var timer = duration,\n                minutes,\n                seconds;\n    interval = setInterval(function() {\n\n        minutes = parseInt(timer / 60, 10);\n        seconds = parseInt(timer % 60, 10);\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        display.textContent = minutes + \":\" + seconds;\n\n        if (--timer < 0) {\n            deleteAllItems();\n\n            clearInterval(interval);\n        }\n    }, 1000);\n}\n\n\n/**\n * Initialize Timer.\n *\n * @param {integer} expirationdate\n *\n */\nfunction initTimer(expirationdate = null) {\n    if (interval) {\n        clearInterval(interval);\n    }\n    let delta = 0;\n    let now = Date.now('UTC');\n    now = (new Date()).getTime() / 1000;\n    if (expirationdate) {\n        delta = (expirationdate - now);\n    }\n    if (delta <= 0) {\n        delta = 0;\n        countdownelement.classList.add(\"hidden\");\n    } else if (delta > 0) {\n        countdownelement.classList.remove(\"hidden\");\n        startTimer(delta, countdownelement);\n    }\n}\n\n/**\n *\n * @param {*} element\n */\n function confirmZeroPriceCheckoutModal(element) {\n\n    getStrings([\n        {key: 'confirmzeropricecheckouttitle', component: 'local_shopping_cart'},\n        {key: 'confirmzeropricecheckoutbody', component: 'local_shopping_cart'},\n        {key: 'confirmzeropricecheckout', component: 'local_shopping_cart'}\n    ]\n    ).then(strings => {\n\n        ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n\n            modal.setTitle(strings[0]);\n                modal.setBody(strings[1]);\n                modal.setSaveButtonText(strings[2]);\n                modal.getRoot().on(ModalEvents.save, function() {\n\n                    const userid = element.dataset.userid;\n\n                    // eslint-disable-next-line no-console\n                    console.log(userid);\n\n                    if (userid) {\n                        confirmPayment(userid);\n                    }\n                });\n\n                modal.show();\n                return modal;\n        }).catch(e => {\n            // eslint-disable-next-line no-console\n            console.log(e);\n        });\n        return true;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n}"],"file":"cart.min.js"}