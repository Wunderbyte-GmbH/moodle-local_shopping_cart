{"version":3,"sources":["../src/cart.js"],"names":["countdownelement","interval","maxitems","itemsleft","visbilityevent","buttoninit","id","component","addtocartbutton","document","querySelector","remove","spanlabel","classList","shoppingcart","cartitem","add","addEventListener","event","contains","preventDefault","stopPropagation","addItem","init","expirationdate","cfgmaxitems","count","parseInt","initTimer","querySelectorAll","forEach","item","addDeleteevent","console","log","visibilityState","reinit","Ajax","call","methodname","args","done","data","Templates","renderForPromise","then","html","container","insertAdjacentHTML","fail","ex","deleteAllItems","total","innerHTML","itemcount1","getElementById","itemcount2","btn","deleteItem","itemprice","dataset","price","innerHTM","Notification","addNotification","message","type","setTimeout","notificationslist","notificatonelement","length","itemname","lastElem","badge","itemid","clearInterval","catch","e","idarray","split","pop","startTimer","duration","display","timer","minutes","seconds","setInterval","textContent","delta","now","Date","getTime"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * @package    local_shopping_cart\r\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Ajax from 'core/ajax';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\n\r\nexport var countdownelement = null;\r\nexport var interval = null;\r\nexport var maxitems = null;\r\nexport var itemsleft = null;\r\nexport var visbilityevent = false;\r\nexport const buttoninit = (id, component) => {\r\n\r\n    // First we get the button and delete the helper-span to secure js loading.\r\n    const addtocartbutton = document.querySelector('#btn-' + component + '-' + id);\r\n\r\n    // If we don't find the button, we abort.\r\n    if (!addtocartbutton) {\r\n        return;\r\n    }\r\n\r\n    // We remove the backup span element, as we don't need it anymore.\r\n    addtocartbutton.querySelector('.loadJavascript').remove();\r\n    // We show the potentially hidden second span element with the button text.\r\n    const spanlabel = addtocartbutton.querySelector('span');\r\n    if (spanlabel) {\r\n        spanlabel.classList.remove('hidden');\r\n    }\r\n\r\n    // Make sure item is not yet in shopping cart. If so, add disabled class.\r\n    const shoppingcart = document.querySelector('#nav-shopping_cart-popover-container');\r\n    if (shoppingcart) {\r\n        const cartitem = shoppingcart.querySelector('#item-' + component + '-' + id);\r\n        if (cartitem) {\r\n            addtocartbutton.classList.add('disabled');\r\n        }\r\n    }\r\n    // Add click eventlistern to oneself.\r\n    addtocartbutton.addEventListener('click', event => {\r\n        // If we find the disabled class, the click event is aborted.\r\n        if (addtocartbutton.classList.contains('disabled')) {\r\n            return;\r\n        }\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        addItem(id, component);\r\n    });\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} expirationdate\r\n * @param {*} cfgmaxitems\r\n * @param {*} count\r\n */\r\n\r\n export const init = (expirationdate, cfgmaxitems, count) => {\r\n    countdownelement = document.querySelector('.expirationdate');\r\n    maxitems = cfgmaxitems;\r\n    count = parseInt(count) ? parseInt(count) : 0;\r\n    itemsleft = maxitems - count;\r\n\r\n    initTimer(expirationdate);\r\n\r\n    document.querySelectorAll('.fa-trash-o').forEach(item => {\r\n        addDeleteevent(item);\r\n        // eslint-disable-next-line no-console\r\n        console.log(\"setdel\");\r\n    });\r\n    if (visbilityevent == false) {\r\n        document.addEventListener(\"visibilitychange\", function() {\r\n            visbilityevent = true;\r\n            if (document.visibilityState === 'visible') {\r\n                // eslint-disable-next-line no-console\r\n                console.log(\"vis\");\r\n                reinit();\r\n            } else {\r\n                // eslint-disable-next-line no-console\r\n                console.log(\"hid\");\r\n            }\r\n        });\r\n    }\r\n};\r\n/**\r\n * Reinit cart after Tabswitch.\r\n */\r\nexport const reinit = () => {\r\n    Ajax.call([{\r\n        methodname: \"local_shopping_cart_get_shopping_cart_items\",\r\n        args: {\r\n        },\r\n        done: function(data) {\r\n            Templates.renderForPromise('local_shopping_cart/shopping_cart_items', data).then(({html}) => {\r\n                document.querySelector('.shopping-cart-items').remove();\r\n                let container = document.querySelector('#nav-shopping_cart-popover-container .popover-region-content-container');\r\n                container.insertAdjacentHTML('afterbegin', html);\r\n            });\r\n            init(data.expirationdate, data.maxitems, data.count);\r\n\r\n           // eslint-disable-next-line no-console\r\n           console.log(\"done\");\r\n        },\r\n        fail: function(ex) {\r\n            // eslint-disable-next-line no-console\r\n            console.log(\"ex:\" + ex);\r\n        },\r\n    }]);\r\n}\r\n/**\r\n * Delete all Items (e.g. gets called after expirationtime is reached).\r\n */\r\nexport const deleteAllItems = () => {\r\n    Ajax.call([{\r\n        methodname: \"local_shopping_cart_delete_all_items_from_cart\",\r\n        args: {\r\n        },\r\n        done: function() {\r\n            let item = document.querySelectorAll('[id^=item-]');\r\n            item.forEach(item => {\r\n                if (item) {\r\n                    item.remove();\r\n                }\r\n            });\r\n            itemsleft = maxitems;\r\n            let total = document.querySelectorAll('#totalprice');\r\n            total.forEach(total => {\r\n                total.innerHTML = 0;\r\n            });\r\n            let itemcount1 = document.getElementById(\"countbadge\");\r\n            let itemcount2 = document.getElementById(\"itemcount\");\r\n\r\n            itemcount1.innerHTML = 0;\r\n            itemcount2.innerHTML = 0;\r\n            itemcount2.classList.add(\"hidden\");\r\n\r\n            // Make sure addtocartbutton active againe once the item is removed from the shopping cart.\r\n            const addtocartbutton = document.querySelectorAll('[id^=btn-].disabled');\r\n            addtocartbutton.forEach(btn => {\r\n                if (btn) {\r\n                    btn.classList.remove('disabled');\r\n                }\r\n            });\r\n        },\r\n        fail: function(ex) {\r\n            // eslint-disable-next-line no-console\r\n            console.log(ex);\r\n        },\r\n    }]);\r\n};\r\n\r\nexport const deleteItem = (id, component) => {\r\n    Ajax.call([{\r\n        methodname: \"local_shopping_cart_delete_item\",\r\n        args: {\r\n            'itemid': id,\r\n            'component': component\r\n        },\r\n        done: function() {\r\n            itemsleft = itemsleft + 1;\r\n\r\n            let item = document.querySelectorAll('#item-' + component + '-' + id);\r\n            let itemprice = item[0].dataset.price;\r\n            item.forEach(item => {\r\n                if (item) {\r\n                    item.remove();\r\n                }\r\n            });\r\n            let total = document.querySelectorAll('#totalprice');\r\n            total.forEach(total => {\r\n                total = total == \"undefined\" ? total = 0 : total;\r\n                total.innerHTML -= itemprice;\r\n            });\r\n            let itemcount1 = document.getElementById(\"countbadge\");\r\n            let itemcount2 = document.getElementById(\"itemcount\");\r\n\r\n            itemcount1.innerHTM = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\r\n            itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\r\n            itemcount2.innerHTML = itemcount2.innerHTML == 0 ? itemcount2.classList.add(\"hidden\") : itemcount2.innerHTML;\r\n            // Make sure addtocartbutton active againe once the item is removed from the shopping cart.\r\n            const addtocartbutton = document.querySelector('#btn-' + component + '-' + id);\r\n            if (addtocartbutton) {\r\n                addtocartbutton.classList.remove('disabled');\r\n            }\r\n        },\r\n        fail: function(ex) {\r\n            // eslint-disable-next-line no-console\r\n            console.log(id, ex);\r\n            let item = document.querySelector('#item-' + component + '-' + id);\r\n            if (item) {\r\n                item.remove();\r\n                let itemcount1 = document.getElementById(\"countbadge\");\r\n                let itemcount2 = document.getElementById(\"itemcount\");\r\n                itemcount1.innerHTML = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\r\n                itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\r\n                itemcount2.innerHTML = itemcount2.innerHTML == 0 ? itemcount2.classList.add(\"hidden\") : itemcount2.innerHTML;\r\n                let itemprice = item.dataset.price;\r\n                let total = document.getElementById('totalprice');\r\n                total = total == \"undefined\" ? total = 0 : total;\r\n                total.innerHTML -= itemprice;\r\n            }\r\n        },\r\n    }]);\r\n};\r\n\r\nexport const addItem = (id, component) => {\r\n\r\n    if (itemsleft == 0) {\r\n        Notification.addNotification({\r\n            message: \"Cart is full\",\r\n            type: \"danger\"\r\n        });\r\n        setTimeout(() => {\r\n            let notificationslist = document.querySelectorAll('#user-notifications div.alert.alert-danger');\r\n            const notificatonelement = notificationslist[notificationslist.length - 1];\r\n            notificatonelement.remove();\r\n        }, 5000);\r\n        return;\r\n    } else {\r\n        itemsleft -= 1;\r\n    }\r\n\r\n    Ajax.call([{\r\n        methodname: \"local_shopping_cart_add_item\",\r\n        args: {\r\n            'component': component,\r\n            'itemid': id\r\n        },\r\n        done: function(data) {\r\n            data.component = component;\r\n            data.id = id;\r\n            Notification.addNotification({\r\n                message: data.itemname + \" added to cart\",\r\n                type: \"success\"\r\n            });\r\n\r\n            setTimeout(() => {\r\n                let notificationslist = document.querySelectorAll('#user-notifications div.alert.alert-success');\r\n\r\n                const notificatonelement = notificationslist[notificationslist.length - 1];\r\n\r\n                notificatonelement.remove();\r\n            }, 5000);\r\n            Templates.renderForPromise('local_shopping_cart/shopping_cart_item', data).then(({html}) => {\r\n                let lastElem = document.getElementById('litotalprice');\r\n                lastElem.insertAdjacentHTML('beforeBegin', html);\r\n                document.getElementById(\"countbadge\").innerHTML++;\r\n                const badge = document.getElementById(\"itemcount\");\r\n                badge.innerHTML = (parseInt(badge.innerHTML) || 0) + 1;\r\n                badge.classList.remove('hidden');\r\n                let total = document.getElementById('totalprice');\r\n                total.innerHTML = (parseInt(total.innerHTML) || 0) + parseInt(data.price);\r\n                let item = document.querySelector('#item-' + component + '-' + data.itemid + ' .fa-trash-o');\r\n                addDeleteevent(item);\r\n                clearInterval(interval);\r\n                initTimer(data.expirationdate);\r\n\r\n                // Make sure addtocartbutton is disabled once the item is in the shopping cart.\r\n                const addtocartbutton = document.querySelector('#btn-' + component + '-' + data.itemid);\r\n                if (addtocartbutton) {\r\n                    addtocartbutton.classList.add('disabled');\r\n                }\r\n                return true;\r\n            }).catch((e) => {\r\n                // eslint-disable-next-line no-console\r\n                console.log(e);\r\n            });\r\n        },\r\n        fail: function(ex) {\r\n            itemsleft = itemsleft + 1;\r\n            // eslint-disable-next-line no-console\r\n            console.log('error', ex);\r\n        }\r\n    }], true);\r\n};\r\n\r\n/**\r\n * Delete Event.\r\n * @param {HTMLElement} item\r\n */\r\nfunction addDeleteevent(item) {\r\n    item.addEventListener('click', event => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        let idarray = item.dataset.id.split('-');\r\n\r\n        let id = idarray.pop();\r\n        let component = idarray.pop();\r\n        deleteItem(id, component);\r\n    });\r\n}\r\n\r\n/**\r\n * Start the timer.\r\n *\r\n * @param {integer} duration\r\n * @param {integer} display\r\n */\r\nfunction startTimer(duration, display) {\r\n\r\n    var timer = duration,\r\n                minutes,\r\n                seconds;\r\n    interval = setInterval(function() {\r\n\r\n        minutes = parseInt(timer / 60, 10);\r\n        seconds = parseInt(timer % 60, 10);\r\n\r\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\r\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\r\n\r\n        display.textContent = minutes + \":\" + seconds;\r\n\r\n        if (--timer < 0) {\r\n            deleteAllItems();\r\n\r\n            clearInterval(interval);\r\n        }\r\n    }, 1000);\r\n}\r\n\r\n\r\n/**\r\n * Initialize Timer.\r\n *\r\n * @param {integer} expirationdate\r\n *\r\n */\r\nfunction initTimer(expirationdate) {\r\n        if (interval) {\r\n            clearInterval(interval);\r\n        }\r\n        let delta = 0;\r\n        let now = Date.now('UTC');\r\n        now = (new Date()).getTime() / 1000;\r\n        delta = (expirationdate - now);\r\n\r\n        if (delta < 0) {\r\n            delta = 0;\r\n        }\r\n        startTimer(delta, countdownelement);\r\n}\r\n\r\n"],"file":"cart.min.js"}