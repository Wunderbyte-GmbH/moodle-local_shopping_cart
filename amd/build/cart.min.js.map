{"version":3,"file":"cart.min.js","sources":["../src/cart.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_shopping_cart\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nimport {confirmPayment} from 'local_shopping_cart/cashier';\nimport {addDiscountEvent} from 'local_shopping_cart/cashier';\n\nimport {\n    get_strings as getStrings\n        }\n        from 'core/str';\n\nexport var countdownelement = null;\nexport var interval = null;\nexport var visbilityevent = false;\n\nexport const reloadAllButtons = () => {\n    const addtocartbuttons = document.querySelectorAll('[id^=btn-]');\n    addtocartbuttons.forEach(button => {\n        button.classList.remove('disabled');\n    });\n};\n\nconst SELECTORS = {\n    SHOPPING_CART_ITEM: '[data-item=\"shopping_cart_item\"]',\n};\n\nexport const buttoninit = (itemid, component) => {\n\n    // If there is no itemid, we browse the whole document and init all buttons individually.\n    if (!itemid) {\n        const buttons = document.querySelectorAll(SELECTORS.SHOPPING_CART_ITEM);\n        buttons.forEach(button => {\n            const number = button.itemid;\n            buttoninit(number, component);\n        });\n        return;\n    }\n\n    // First we get the button and delete the helper-span to secure js loading.\n    const addtocartbutton = document.querySelector('#btn-' + component + '-' + itemid);\n\n    // If we don't find the button, we abort.\n    if (!addtocartbutton || addtocartbutton.dataset.initialized === 'true') {\n        return;\n    }\n\n    // Make sure item is not yet in shopping cart. If so, add disabled class.\n    let shoppingcart = document.querySelector('#shopping_cart-cashiers-cart');\n\n    if (!shoppingcart) {\n        shoppingcart = document.querySelector('#nav-shopping_cart-popover-container');\n    }\n\n    if (shoppingcart) {\n        const cartitem = shoppingcart.querySelector('[id^=\"item-' + component + '-' + itemid + ']');\n        if (cartitem) {\n            addtocartbutton.classList.add('disabled');\n        }\n    }\n    // Add click eventlistern to oneself.\n    addtocartbutton.addEventListener('click', event => {\n\n         // eslint-disable-next-line no-console\n         console.log('button clicked', itemid);\n\n        // If we find the disabled class, the click event is aborted.\n        if (addtocartbutton.classList.contains('disabled')) {\n            return;\n        }\n        event.preventDefault();\n        event.stopPropagation();\n        addItem(itemid, component);\n    });\n    addtocartbutton.dataset.initialized = 'true';\n};\n\n/**\n *\n * @param {*} expirationdate\n */\n\n export const init = (expirationdate) => {\n    countdownelement = document.querySelector('.expirationdate');\n    initTimer(expirationdate);\n    if (visbilityevent == false) {\n        let items = document.querySelectorAll(SELECTORS.SHOPPING_CART_ITEM + ' .fa-trash-o');\n        items.forEach(item => {\n            addDeleteevent(item);\n        });\n\n        items = document.querySelectorAll(SELECTORS.SHOPPING_CART_ITEM + ' .fa-eur');\n        items.forEach(item => {\n            addDiscountEvent(item);\n        });\n        document.addEventListener(\"visibilitychange\", function() {\n            visbilityevent = true;\n            if (document.visibilityState === 'visible') {\n                reinit();\n            }\n        });\n    }\n    updateTotalPrice();\n};\n\nexport const reinit = () => {\n    reloadAllButtons();\n    Ajax.call([{\n        methodname: \"local_shopping_cart_get_shopping_cart_items\",\n        args: {\n        },\n        done: function(data) {\n            Templates.renderForPromise('local_shopping_cart/shopping_cart_items', data).then(({html}) => {\n                document.querySelector('.shopping-cart-items').remove();\n                let container = document.querySelector('#nav-shopping_cart-popover-container .shopping-cart-items-container');\n                container.insertAdjacentHTML('afterbegin', html);\n                data.items.forEach(item => {\n                    buttoninit(item.itemid, item.component);\n                });\n                let deleteaction = document.querySelectorAll('.fa-trash-o');\n                deleteaction.forEach(item => {\n                    addDeleteevent(item);\n                });\n                let itemcount = document.getElementById(\"itemcount\");\n                itemcount.innerHTML = data.count;\n                document.getElementById(\"countbadge\").innerHTML = data.count;\n                if (data.count > 0) {\n                    itemcount.classList.remove(\"hidden\");\n                } else {\n                    itemcount.classList.add(\"hidden\");\n                }\n                initTimer(data.expirationdate);\n                return true;\n            }).catch((e) => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(\"ex:\" + ex);\n        },\n    }]);\n};\n\nexport const deleteAllItems = () => {\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_all_items_from_cart\",\n        args: {\n        },\n        done: function() {\n            let item = document.querySelectorAll(SELECTORS.SHOPPING_CART_ITEM);\n            item.forEach(item => {\n                if (item) {\n                    item.remove();\n                }\n            });\n\n            updateTotalPrice();\n\n            let itemcount1 = document.getElementById(\"countbadge\");\n            let itemcount2 = document.getElementById(\"itemcount\");\n\n            itemcount1.innerHTML = 0;\n            itemcount2.innerHTML = 0;\n            itemcount2.classList.add(\"hidden\");\n\n            // Make sure addtocartbutton active againe once the item is removed from the shopping cart.\n            const addtocartbutton = document.querySelectorAll('[id^=btn-].disabled');\n            addtocartbutton.forEach(btn => {\n                if (btn) {\n                    btn.classList.remove('disabled');\n                }\n            });\n            // eslint-disable-next-line no-console\n            console.log('All items have been removed from cart.');\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(ex);\n        },\n    }]);\n};\n\nexport const deleteItem = (itemid, component, userid) => {\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_item\",\n        args: {\n            'itemid': itemid,\n            'component': component,\n            'userid': userid\n        },\n        done: function() {\n\n            // We might display the item more often than once.\n            let items = document.querySelectorAll(SELECTORS.SHOPPING_CART_ITEM);\n\n            items.forEach(item => {\n                if (item) {\n                    item.remove();\n                }\n            });\n\n            updateTotalPrice(userid);\n\n            let itemcount1 = document.getElementById(\"countbadge\");\n            let itemcount2 = document.getElementById(\"itemcount\");\n\n            itemcount1.innerHTM = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\n            itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\n\n            // If we have only one item left, we set back the expiration date.\n            if (itemcount2.innerHTML == 0) {\n                itemcount2.classList.add(\"hidden\");\n\n                // We clear the countdown and set back the timer.\n                clearInterval(interval);\n                initTimer();\n            }\n\n            // Make sure addtocartbutton active againe once the item is removed from the shopping cart.\n            const addtocartbutton = document.querySelector('#btn-' + component + '-' + itemid);\n            if (addtocartbutton) {\n                addtocartbutton.classList.remove('disabled');\n                buttoninit(itemid, component);\n            }\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(itemid, ex);\n            let item = document.querySelector('[id^=\"item-' + component + '-' + itemid + ']');\n            if (item) {\n                item.remove();\n                let itemcount1 = document.getElementById(\"countbadge\");\n                let itemcount2 = document.getElementById(\"itemcount\");\n                itemcount1.innerHTML = itemcount1.innerHTML > 0 ? itemcount1.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML > 0 ? itemcount2.innerHTML -= 1 : itemcount1.innerHTML;\n                itemcount2.innerHTML = itemcount2.innerHTML == 0 ? itemcount2.classList.add(\"hidden\") : itemcount2.innerHTML;\n                let itemprice = item.dataset.price;\n\n                // eslint-disable-next-line no-console\n                console.log('itemprice', itemprice);\n                updateTotalPrice(userid);\n            }\n        },\n    }]);\n};\n\nexport const addItem = (itemid, component) => {\n\n    const oncashier = window.location.href.indexOf(\"cashier.php\");\n\n    let userid = 0;\n    if (oncashier > 0) {\n        userid = -1;\n    }\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_add_item\",\n        args: {\n            'component': component,\n            'itemid': itemid,\n            'userid': userid\n        },\n        done: function(data) {\n            data.component = component;\n            data.itemid = itemid;\n            data.userid = data.buyforuser; // For the mustache template, we need to obey structure.\n\n            if (data.success != 1) {\n                Notification.addNotification({\n                    message: \"Cart is full\",\n                    type: \"danger\"\n                });\n                setTimeout(() => {\n                    let notificationslist = document.querySelectorAll('#user-notifications div.alert.alert-danger');\n                    const notificatonelement = notificationslist[notificationslist.length - 1];\n                    notificatonelement.remove();\n                }, 5000);\n                return;\n            } else if (data.success == 1) {\n                Notification.addNotification({\n                    message: data.itemname + \" added to cart\",\n                    type: \"success\"\n                });\n\n                setTimeout(() => {\n                    let notificationslist = document.querySelectorAll('#user-notifications div.alert.alert-success');\n\n                    const notificatonelement = notificationslist[notificationslist.length - 1];\n\n                    notificatonelement.remove();\n                }, 5000);\n\n                // If we are on the cashier page, we add the possiblity to add a discount to the cart items.\n                const oncashier = window.location.href.indexOf(\"cashier.php\");\n                if (oncashier) {\n                    data.iscashier = true;\n                }\n\n                Templates.renderForPromise('local_shopping_cart/shopping_cart_item', data).then(({html}) => {\n                    let lastElements = document.querySelectorAll(\"li.sc_initialtotal_cashier\");\n                    lastElements.forEach(lastElem => {\n\n                        // eslint-disable-next-line no-console\n                        console.log('found li', lastElem);\n\n                        // If we buy for a user, we only want to interact with the cashiers section.\n                        if ((data.buyforuser == 0)\n                            || (lastElem.className === \"sc_initialtotal_cashier\")) {\n                            lastElem.insertAdjacentHTML('beforeBegin', html);\n                        }\n                    });\n\n                    // Make sure addtocartbutton is disabled once the item is in the shopping cart.\n                    const addtocartbutton = document.querySelector('#btn-' + component + '-' + data.itemid);\n                    if (addtocartbutton) {\n                        addtocartbutton.classList.add('disabled');\n                        addtocartbutton.removeEventListener('click', deleteEvent);\n                    }\n\n                    let items = document.querySelectorAll(SELECTORS.SHOPPING_CART_ITEM + ' .fa-trash-o');\n                    items.forEach(item => {\n                        addDeleteevent(item, data.userid);\n                    });\n\n                    items = document.querySelectorAll(SELECTORS.SHOPPING_CART_ITEM + ' .fa-eur');\n                    items.forEach(item => {\n                        addDiscountEvent(item, data.userid);\n                    });\n\n                    updateTotalPrice(data.userid);\n\n                    // If we buy for a user, we don't have to do the navbar stuff below.\n                    if (data.buyforuser != 0) {\n                        return;\n                    }\n                    document.getElementById(\"countbadge\").innerHTML++;\n                    const badge = document.getElementById(\"itemcount\");\n                    badge.innerHTML = (parseInt(badge.innerHTML) || 0) + 1;\n                    badge.classList.remove('hidden');\n                    updateTotalPrice(data.userid);\n                    clearInterval(interval);\n                    initTimer(data.expirationdate);\n                    return;\n                }).catch((e) => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n            }\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log('error', ex);\n        }\n    }], true);\n};\n\n/**\n *\n * @param {*} userid\n * @param {*} usecredit\n */\nexport const updateTotalPrice = (userid = 0, usecredit = true) => {\n\n    // eslint-disable-next-line no-console\n    console.log('updatetotalprice');\n\n    // First, get the state of usecredit.\n    const oncashier = window.location.href.indexOf(\"cashier.php\");\n\n    let labelareas = null;\n    if (oncashier > 0) {\n        labelareas = document.querySelectorAll('div.sc_price_label');\n    } else {\n        labelareas = document.querySelectorAll('li.sc_price_label');\n    }\n\n    labelareas.forEach(element => {\n\n        // eslint-disable-next-line no-console\n        console.log(element);\n\n        // First we update the userid, if possible.\n        userid = element.dataset.userid ? element.dataset.userid : userid;\n\n        const checkbox = element.querySelector('input.usecredit-checkbox');\n\n        if (checkbox) {\n            if (checkbox.checked) {\n\n                // eslint-disable-next-line no-console\n                console.log('checked', checkbox.checked);\n                usecredit = checkbox.checked;\n            } else {\n                usecredit = 0;\n            }\n        }\n    });\n\n    usecredit = usecredit ? 1 : 0;\n\n    // eslint-disable-next-line no-console\n    console.log('usecredit before ajax', usecredit);\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_get_price\",\n        args: {\n            userid,\n            usecredit\n        },\n        done: function(data) {\n\n            // eslint-disable-next-line no-console\n            console.log(data);\n\n            // We take the usecredit value we receive from the server.\n            if (data.usecredit == 1) {\n                data.usecreditclass = 'checked';\n            } else {\n                data.usecreditclass = '';\n            }\n\n            const initialtotal = data.initialtotal;\n\n            let shoppingcart = document.querySelector('#shopping_cart-cashiers-cart');\n            let cashierssection = null;\n            let checkoutcart = null;\n            let checkouttotals = null;\n\n            if (!shoppingcart) {\n                shoppingcart = document.querySelector('#nav-shopping_cart-popover-container');\n                checkoutcart = document.querySelector('div.checkoutgrid.checkout');\n                // eslint-disable-next-line no-console\n                console.log('1', checkoutcart);\n            } else {\n                cashierssection = document.querySelector('#shopping_cart-cashiers-section');\n            }\n\n            let totals = [];\n            if (cashierssection) {\n                totals = cashierssection.querySelectorAll('.initialtotal');\n            } else {\n                // First we add the total price from navbar.\n                totals = shoppingcart.querySelectorAll('.initialtotal');\n\n                // If we are on the checkout site, we deal with the totals there separately.\n                if (checkoutcart) {\n                    checkouttotals = checkoutcart.querySelectorAll('.initialtotal');\n\n                    if (checkouttotals) {\n                        checkouttotals.forEach(total => {\n                            total.innerHTML = initialtotal;\n                        });\n                    }\n                }\n            }\n\n            let paymentbutton = document.querySelector(\".shopping_cart_payment_region button\");\n\n            if (paymentbutton) {\n\n                const price = data.price;\n                const currency = data.currency;\n\n                // eslint-disable-next-line no-console\n                console.log(\"paymentbutton\", price, currency);\n\n                paymentbutton.dataset.cost = price + \" \" + currency;\n\n                if (price == 0) {\n                    // eslint-disable-next-line no-console\n                    console.log('price is 0');\n                    paymentbutton.addEventListener('click', dealWithZeroPrice);\n                } else {\n                    // eslint-disable-next-line no-console\n                    console.log('price is not 0');\n                    paymentbutton.removeEventListener('click', dealWithZeroPrice);\n                }\n            }\n\n            // Run through the list of total prices and set them to the right one.\n            totals.forEach(total => {\n                total.innerHTML = initialtotal;\n            });\n\n            data.checkboxid = Math.random().toString(36).slice(2, 5);\n\n            Templates.renderForPromise('local_shopping_cart/price_label', data).then(({html}) => {\n                labelareas.forEach(element => {\n                    // First, clean all children.\n                    let child = element.lastElementChild;\n                    while (child) {\n                        element.removeChild(child);\n                        child = element.lastElementChild;\n                    }\n                    element.insertAdjacentHTML(\"afterbegin\", html);\n\n                    const checkbox = element.querySelector('input.usecredit-checkbox');\n\n                    if (checkbox) {\n                        checkbox.addEventListener('change', event => {\n\n                            // eslint-disable-next-line no-console\n                            console.log(event);\n\n                            updateTotalPrice(userid);\n                        });\n                    }\n\n                });\n                return true;\n            }).catch((e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            }));\n\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log('error', ex);\n        }\n    }], true);\n};\n\n/**\n *\n * @param {*} event\n */\nfunction dealWithZeroPrice(event) {\n\n    // eslint-disable-next-line no-console\n    console.log('onlymyclickcounts');\n\n        event.stopPropagation();\n        event.preventDefault();\n        // eslint-disable-next-line no-console\n        console.log('onlymyclickcounts', event.target);\n\n        confirmZeroPriceCheckoutModal(event.target);\n}\n\n/**\n * Delete Event.\n * @param {HTMLElement} item\n * @param {int} userid\n */\nfunction addDeleteevent(item, userid = 0) {\n    if (userid !== 0) {\n        item.dataset.userid = '' + userid;\n    }\n    item.addEventListener('click', deleteEvent);\n}\n\n/**\n * Function called in listener.\n */\nfunction deleteEvent() {\n        const item = this;\n        // eslint-disable-next-line no-console\n        console.log('item', item);\n        // Item comes as #item-booking-213123.\n        const itemid = item.dataset.itemid;\n        const component = item.dataset.component;\n        let userid = item.dataset.userid;\n        if (!userid) {\n            userid = 0;\n        }\n        deleteItem(itemid, component, userid);\n    }\n\n/**\n * Start the timer.\n *\n * @param {integer} duration\n * @param {integer} display\n */\nfunction startTimer(duration, display) {\n\n    var timer = duration,\n                minutes,\n                seconds;\n    interval = setInterval(function() {\n\n        minutes = parseInt(timer / 60, 10);\n        seconds = parseInt(timer % 60, 10);\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        display.textContent = minutes + \":\" + seconds;\n\n        if (--timer < 0) {\n            deleteAllItems();\n\n            clearInterval(interval);\n        }\n    }, 1000);\n}\n\n\n/**\n * Initialize Timer.\n *\n * @param {integer} expirationdate\n *\n */\nfunction initTimer(expirationdate = null) {\n    if (interval) {\n        clearInterval(interval);\n    }\n    let delta = 0;\n    let now = Date.now('UTC');\n    now = (new Date()).getTime() / 1000;\n    if (expirationdate) {\n        delta = (expirationdate - now);\n    }\n    if (delta <= 0) {\n        delta = 0;\n        countdownelement.classList.add(\"hidden\");\n    } else if (delta > 0) {\n        countdownelement.classList.remove(\"hidden\");\n        startTimer(delta, countdownelement);\n    }\n}\n\n/**\n *\n * @param {*} element\n */\n function confirmZeroPriceCheckoutModal(element) {\n\n    getStrings([\n        {key: 'confirmzeropricecheckouttitle', component: 'local_shopping_cart'},\n        {key: 'confirmzeropricecheckoutbody', component: 'local_shopping_cart'},\n        {key: 'confirmzeropricecheckout', component: 'local_shopping_cart'}\n    ]\n    ).then(strings => {\n\n        ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n\n            modal.setTitle(strings[0]);\n                modal.setBody(strings[1]);\n                modal.setSaveButtonText(strings[2]);\n                modal.getRoot().on(ModalEvents.save, function() {\n\n                    const userid = element.dataset.userid;\n\n                    // eslint-disable-next-line no-console\n                    console.log(userid);\n\n                    if (userid) {\n                        confirmPayment(userid);\n                    }\n                });\n\n                modal.show();\n                return modal;\n        }).catch(e => {\n            // eslint-disable-next-line no-console\n            console.log(e);\n        });\n        return true;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n}\n"],"names":["countdownelement","interval","visbilityevent","reloadAllButtons","document","querySelectorAll","forEach","button","classList","remove","SELECTORS","buttoninit","itemid","component","number","addtocartbutton","querySelector","dataset","initialized","shoppingcart","add","addEventListener","event","console","log","contains","preventDefault","stopPropagation","addItem","expirationdate","initTimer","items","item","addDeleteevent","visibilityState","reinit","updateTotalPrice","call","methodname","args","done","data","renderForPromise","then","_ref","html","insertAdjacentHTML","itemcount","getElementById","innerHTML","count","catch","e","fail","ex","deleteAllItems","itemcount1","itemcount2","btn","deleteItem","userid","innerHTM","clearInterval","itemprice","price","window","location","href","indexOf","buyforuser","success","addNotification","message","type","setTimeout","notificationslist","length","itemname","iscashier","_ref2","lastElem","className","removeEventListener","deleteEvent","badge","parseInt","usecredit","oncashier","labelareas","element","checkbox","checked","usecreditclass","initialtotal","cashierssection","checkoutcart","checkouttotals","totals","total","paymentbutton","currency","cost","dealWithZeroPrice","checkboxid","Math","random","toString","slice","_ref3","child","lastElementChild","removeChild","target","key","strings","create","ModalFactory","types","SAVE_CANCEL","modal","setTitle","setBody","setSaveButtonText","getRoot","on","ModalEvents","save","show","this","startTimer","duration","display","minutes","seconds","timer","setInterval","textContent","delta","now","Date","getTime"],"mappings":";;;;;+hBAoCWA,iBAAmB,oDACnBC,SAAW,oCACXC,gBAAiB,+CAEfC,iBAAmB,KACHC,SAASC,iBAAiB,cAClCC,SAAQC,SACrBA,OAAOC,UAAUC,OAAO,iEAI1BC,6BACkB,mCAGXC,WAAa,CAACC,OAAQC,iBAG1BD,OAAQ,aACOR,SAASC,iBAAiBK,8BAClCJ,SAAQC,eACNO,OAASP,OAAOK,OACtBD,WAAWG,OAAQD,oBAMrBE,gBAAkBX,SAASY,cAAc,QAAUH,UAAY,IAAMD,YAGtEG,iBAA2D,SAAxCA,gBAAgBE,QAAQC,uBAK5CC,aAAef,SAASY,cAAc,mCAErCG,eACDA,aAAef,SAASY,cAAc,yCAGtCG,aAAc,CACGA,aAAaH,cAAc,cAAgBH,UAAY,IAAMD,OAAS,MAEnFG,gBAAgBP,UAAUY,IAAI,YAItCL,gBAAgBM,iBAAiB,SAASC,QAGrCC,QAAQC,IAAI,iBAAkBZ,QAG3BG,gBAAgBP,UAAUiB,SAAS,cAGvCH,MAAMI,iBACNJ,MAAMK,kBACNC,QAAQhB,OAAQC,eAEpBE,gBAAgBE,QAAQC,YAAc,qDAQpBW,8CAClB7B,iBAAmBI,SAASY,cAAc,mBAC1Cc,UAAUD,gBACY,GAAlB3B,eAAyB,KACrB6B,MAAQ3B,SAASC,iBAAiBK,6BAA+B,gBACrEqB,MAAMzB,SAAQ0B,OACVC,eAAeD,SAGnBD,MAAQ3B,SAASC,iBAAiBK,6BAA+B,YACjEqB,MAAMzB,SAAQ0B,qCACOA,SAErB5B,SAASiB,iBAAiB,oBAAoB,mCAC1CnB,gBAAiB,EACgB,YAA7BE,SAAS8B,iBACTC,YAIZC,0BAGSD,OAAS,KAClBhC,iCACKkC,KAAK,CAAC,CACPC,WAAY,8CACZC,KAAM,GAENC,KAAM,SAASC,yBACDC,iBAAiB,0CAA2CD,MAAME,MAAKC,WAACC,KAACA,WAC/EzC,SAASY,cAAc,wBAAwBP,SAC/BL,SAASY,cAAc,uEAC7B8B,mBAAmB,aAAcD,MAC3CJ,KAAKV,MAAMzB,SAAQ0B,OACfrB,WAAWqB,KAAKpB,OAAQoB,KAAKnB,cAEdT,SAASC,iBAAiB,eAChCC,SAAQ0B,OACjBC,eAAeD,aAEfe,UAAY3C,SAAS4C,eAAe,oBACxCD,UAAUE,UAAYR,KAAKS,MAC3B9C,SAAS4C,eAAe,cAAcC,UAAYR,KAAKS,MACnDT,KAAKS,MAAQ,EACbH,UAAUvC,UAAUC,OAAO,UAE3BsC,UAAUvC,UAAUY,IAAI,UAE5BU,UAAUW,KAAKZ,iBACR,KACRsB,OAAOC,IAEN7B,QAAQC,IAAI4B,OAGpBC,KAAM,SAASC,IAEX/B,QAAQC,IAAI,MAAQ8B,sCAKnBC,eAAiB,mBACrBlB,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,GAENC,KAAM,WACSpC,SAASC,iBAAiBK,8BAChCJ,SAAQ0B,OACLA,MACAA,KAAKvB,YAIb2B,uBAEIoB,WAAapD,SAAS4C,eAAe,cACrCS,WAAarD,SAAS4C,eAAe,aAEzCQ,WAAWP,UAAY,EACvBQ,WAAWR,UAAY,EACvBQ,WAAWjD,UAAUY,IAAI,UAGDhB,SAASC,iBAAiB,uBAClCC,SAAQoD,MAChBA,KACAA,IAAIlD,UAAUC,OAAO,eAI7Bc,QAAQC,IAAI,2CAEhB6B,KAAM,SAASC,IAEX/B,QAAQC,IAAI8B,sDAKXK,WAAa,CAAC/C,OAAQC,UAAW+C,wBAErCvB,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,QACQ3B,iBACGC,iBACH+C,QAEdpB,KAAM,WAGUpC,SAASC,iBAAiBK,8BAEhCJ,SAAQ0B,OACNA,MACAA,KAAKvB,YAIb2B,iBAAiBwB,YAEbJ,WAAapD,SAAS4C,eAAe,cACrCS,WAAarD,SAAS4C,eAAe,aAEzCQ,WAAWK,SAAWL,WAAWP,UAAY,EAAIO,WAAWP,WAAa,EAAIO,WAAWP,UACxFQ,WAAWR,UAAYQ,WAAWR,UAAY,EAAIQ,WAAWR,WAAa,EAAIO,WAAWP,UAG7D,GAAxBQ,WAAWR,YACXQ,WAAWjD,UAAUY,IAAI,UAGzB0C,cAAc7D,UACd6B,mBAIEf,gBAAkBX,SAASY,cAAc,QAAUH,UAAY,IAAMD,QACvEG,kBACAA,gBAAgBP,UAAUC,OAAO,YACjCE,WAAWC,OAAQC,aAG3BwC,KAAM,SAASC,IAEX/B,QAAQC,IAAIZ,OAAQ0C,QAChBtB,KAAO5B,SAASY,cAAc,cAAgBH,UAAY,IAAMD,OAAS,QACzEoB,KAAM,CACNA,KAAKvB,aACD+C,WAAapD,SAAS4C,eAAe,cACrCS,WAAarD,SAAS4C,eAAe,aACzCQ,WAAWP,UAAYO,WAAWP,UAAY,EAAIO,WAAWP,WAAa,EAAIO,WAAWP,UACzFQ,WAAWR,UAAYQ,WAAWR,UAAY,EAAIQ,WAAWR,WAAa,EAAIO,WAAWP,UACzFQ,WAAWR,UAAoC,GAAxBQ,WAAWR,UAAiBQ,WAAWjD,UAAUY,IAAI,UAAYqC,WAAWR,cAC/Fc,UAAY/B,KAAKf,QAAQ+C,MAG7BzC,QAAQC,IAAI,YAAauC,WACzB3B,iBAAiBwB,mDAMpBhC,QAAU,CAAChB,OAAQC,iBAIxB+C,OAAS,EAFKK,OAAOC,SAASC,KAAKC,QAAQ,eAG/B,IACZR,QAAU,iBAGTvB,KAAK,CAAC,CACPC,WAAY,+BACZC,KAAM,WACW1B,iBACHD,cACAgD,QAEdpB,KAAM,SAASC,SACXA,KAAK5B,UAAYA,UACjB4B,KAAK7B,OAASA,OACd6B,KAAKmB,OAASnB,KAAK4B,WAEC,GAAhB5B,KAAK6B,qCACQC,gBAAgB,CACzBC,QAAS,eACTC,KAAM,gBAEVC,YAAW,SACHC,kBAAoBvE,SAASC,iBAAiB,8CACvBsE,kBAAkBA,kBAAkBC,OAAS,GACrDnE,WACpB,KAEA,GAAoB,GAAhBgC,KAAK6B,QAAc,uBACbC,gBAAgB,CACzBC,QAAS/B,KAAKoC,SAAW,iBACzBJ,KAAM,YAGVC,YAAW,SACHC,kBAAoBvE,SAASC,iBAAiB,+CAEvBsE,kBAAkBA,kBAAkBC,OAAS,GAErDnE,WACpB,KAGewD,OAAOC,SAASC,KAAKC,QAAQ,iBAE3C3B,KAAKqC,WAAY,sBAGXpC,iBAAiB,yCAA0CD,MAAME,MAAKoC,YAAClC,KAACA,YAC3DzC,SAASC,iBAAiB,8BAChCC,SAAQ0E,WAGjBzD,QAAQC,IAAI,WAAYwD,UAGA,GAAnBvC,KAAK4B,YACqB,4BAAvBW,SAASC,WACbD,SAASlC,mBAAmB,cAAeD,eAK7C9B,gBAAkBX,SAASY,cAAc,QAAUH,UAAY,IAAM4B,KAAK7B,QAC5EG,kBACAA,gBAAgBP,UAAUY,IAAI,YAC9BL,gBAAgBmE,oBAAoB,QAASC,kBAG7CpD,MAAQ3B,SAASC,iBAAiBK,6BAA+B,mBACrEqB,MAAMzB,SAAQ0B,OACVC,eAAeD,KAAMS,KAAKmB,WAG9B7B,MAAQ3B,SAASC,iBAAiBK,6BAA+B,YACjEqB,MAAMzB,SAAQ0B,qCACOA,KAAMS,KAAKmB,WAGhCxB,iBAAiBK,KAAKmB,QAGC,GAAnBnB,KAAK4B,kBAGTjE,SAAS4C,eAAe,cAAcC,kBAChCmC,MAAQhF,SAAS4C,eAAe,aACtCoC,MAAMnC,WAAaoC,SAASD,MAAMnC,YAAc,GAAK,EACrDmC,MAAM5E,UAAUC,OAAO,UACvB2B,iBAAiBK,KAAKmB,QACtBE,cAAc7D,UACd6B,UAAUW,KAAKZ,mBAEhBsB,OAAOC,IAEN7B,QAAQC,IAAI4B,QAIxBC,KAAM,SAASC,IAEX/B,QAAQC,IAAI,QAAS8B,QAEzB,mCAQKlB,iBAAmB,eAACwB,8DAAS,EAAG0B,qEAGzC/D,QAAQC,IAAI,0BAGN+D,UAAYtB,OAAOC,SAASC,KAAKC,QAAQ,mBAE3CoB,WAAa,KAEbA,WADAD,UAAY,EACCnF,SAASC,iBAAiB,sBAE1BD,SAASC,iBAAiB,qBAG3CmF,WAAWlF,SAAQmF,UAGflE,QAAQC,IAAIiE,SAGZ7B,OAAS6B,QAAQxE,QAAQ2C,OAAS6B,QAAQxE,QAAQ2C,OAASA,aAErD8B,SAAWD,QAAQzE,cAAc,4BAEnC0E,WACIA,SAASC,SAGTpE,QAAQC,IAAI,UAAWkE,SAASC,SAChCL,UAAYI,SAASC,SAErBL,UAAY,MAKxBA,UAAYA,UAAY,EAAI,EAG5B/D,QAAQC,IAAI,wBAAyB8D,yBAEhCjD,KAAK,CAAC,CACPC,WAAY,gCACZC,KAAM,CACFqB,OAAAA,OACA0B,UAAAA,WAEJ9C,KAAM,SAASC,MAGXlB,QAAQC,IAAIiB,MAGU,GAAlBA,KAAK6C,UACL7C,KAAKmD,eAAiB,UAEtBnD,KAAKmD,eAAiB,SAGpBC,aAAepD,KAAKoD,iBAEtB1E,aAAef,SAASY,cAAc,gCACtC8E,gBAAkB,KAClBC,aAAe,KACfC,eAAiB,KAEhB7E,aAMD2E,gBAAkB1F,SAASY,cAAc,oCALzCG,aAAef,SAASY,cAAc,wCACtC+E,aAAe3F,SAASY,cAAc,6BAEtCO,QAAQC,IAAI,IAAKuE,mBAKjBE,OAAS,GACTH,gBACAG,OAASH,gBAAgBzF,iBAAiB,kBAG1C4F,OAAS9E,aAAad,iBAAiB,iBAGnC0F,eACAC,eAAiBD,aAAa1F,iBAAiB,iBAE3C2F,gBACAA,eAAe1F,SAAQ4F,QACnBA,MAAMjD,UAAY4C,sBAM9BM,cAAgB/F,SAASY,cAAc,2CAEvCmF,cAAe,OAETnC,MAAQvB,KAAKuB,MACboC,SAAW3D,KAAK2D,SAGtB7E,QAAQC,IAAI,gBAAiBwC,MAAOoC,UAEpCD,cAAclF,QAAQoF,KAAOrC,MAAQ,IAAMoC,SAE9B,GAATpC,OAEAzC,QAAQC,IAAI,cACZ2E,cAAc9E,iBAAiB,QAASiF,qBAGxC/E,QAAQC,IAAI,kBACZ2E,cAAcjB,oBAAoB,QAASoB,oBAKnDL,OAAO3F,SAAQ4F,QACXA,MAAMjD,UAAY4C,gBAGtBpD,KAAK8D,WAAaC,KAAKC,SAASC,SAAS,IAAIC,MAAM,EAAG,sBAE5CjE,iBAAiB,kCAAmCD,MAAME,MAAKiE,YAAC/D,KAACA,mBACvE2C,WAAWlF,SAAQmF,cAEXoB,MAAQpB,QAAQqB,sBACbD,OACHpB,QAAQsB,YAAYF,OACpBA,MAAQpB,QAAQqB,iBAEpBrB,QAAQ3C,mBAAmB,aAAcD,YAEnC6C,SAAWD,QAAQzE,cAAc,4BAEnC0E,UACAA,SAASrE,iBAAiB,UAAUC,QAGhCC,QAAQC,IAAIF,OAEZc,iBAAiBwB,eAKtB,KACRT,OAAOC,IAEN7B,QAAQC,IAAI4B,OAIpBC,KAAM,SAASC,IAEX/B,QAAQC,IAAI,QAAS8B,QAEzB,aAOCgD,kBAAkBhF,WAqGamE,QAlGpClE,QAAQC,IAAI,qBAERF,MAAMK,kBACNL,MAAMI,iBAENH,QAAQC,IAAI,oBAAqBF,MAAM0F,QA6FPvB,QA3FFnE,MAAM0F,4BA6F7B,CACP,CAACC,IAAK,gCAAiCpG,UAAW,uBAClD,CAACoG,IAAK,+BAAgCpG,UAAW,uBACjD,CAACoG,IAAK,2BAA4BpG,UAAW,yBAE/C8B,MAAKuE,iCAEUC,OAAO,CAAC1C,KAAM2C,uBAAaC,MAAMC,cAAc3E,MAAK4E,QAE7DA,MAAMC,SAASN,QAAQ,IACnBK,MAAME,QAAQP,QAAQ,IACtBK,MAAMG,kBAAkBR,QAAQ,IAChCK,MAAMI,UAAUC,GAAGC,sBAAYC,MAAM,iBAE3BlE,OAAS6B,QAAQxE,QAAQ2C,OAG/BrC,QAAQC,IAAIoC,QAERA,oCACeA,WAIvB2D,MAAMQ,OACCR,SACZpE,OAAMC,IAEL7B,QAAQC,IAAI4B,OAET,KACRD,OAAMC,IAEL7B,QAAQC,IAAI4B,eAtHXnB,eAAeD,UAAM4B,8DAAS,EACpB,IAAXA,SACA5B,KAAKf,QAAQ2C,OAAS,GAAKA,QAE/B5B,KAAKX,iBAAiB,QAAS8D,sBAM1BA,cAGD5D,QAAQC,IAAI,OAFCwG,YAIPpH,OAJOoH,KAIO/G,QAAQL,OACtBC,UALOmH,KAKU/G,QAAQJ,cAC3B+C,OANSoE,KAMK/G,QAAQ2C,OACrBA,SACDA,OAAS,GAEbD,WAAW/C,OAAQC,UAAW+C,iBAS7BqE,WAAWC,SAAUC,aAGdC,QACAC,QAFRC,MAAQJ,2BAGZjI,SAAWsI,aAAY,WAEnBH,QAAU/C,SAASiD,MAAQ,GAAI,IAC/BD,QAAUhD,SAASiD,MAAQ,GAAI,IAE/BF,QAAUA,QAAU,GAAK,IAAMA,QAAUA,QACzCC,QAAUA,QAAU,GAAK,IAAMA,QAAUA,QAEzCF,QAAQK,YAAcJ,QAAU,IAAMC,UAEhCC,MAAQ,IACV/E,iBAEAO,cAAc7D,aAEnB,cAUE6B,gBAAUD,sEAAiB,KAC5B5B,UACA6D,cAAc7D,cAEdwI,MAAQ,EACRC,IAAMC,KAAKD,IAAI,OACnBA,KAAO,IAAIC,MAAQC,UAAY,IAC3B/G,iBACA4G,MAAS5G,eAAiB6G,KAE1BD,OAAS,GACTA,MAAQ,EACRzI,iBAAiBQ,UAAUY,IAAI,WACxBqH,MAAQ,IACfzI,iBAAiBQ,UAAUC,OAAO,UAClCwH,WAAWQ,MAAOzI"}