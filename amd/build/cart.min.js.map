{"version":3,"file":"cart.min.js","sources":["../src/cart.js"],"sourcesContent":["/* eslint-disable camelcase */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_shopping_cart\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nimport {confirmPayment} from 'local_shopping_cart/cashier';\nimport {discountModal} from 'local_shopping_cart/cashier';\nimport {showNotification} from 'local_shopping_cart/notifications';\n\nimport DynamicForm from 'core_form/dynamicform';\n\nimport {\n    get_strings as getStrings,\n    get_string as getString\n}\n    from 'core/str';\nimport {modifyTimeModal} from './cashier';\n\nexport var interval = null;\nexport var visbilityevent = false;\n\n// This file inits the cart on every page, on checkout and cashier.\n// The cart is always loaed entirely and replaced via css.\n// The cashiers cart are identified in the DOM via userid -1 (CASHIERUSER).\n// The translation to real userids is done in the PHP only.\n\nconst CASHIERUSER = -1;\n\nconst SELECTORS = {\n    SHOPPING_CART_ITEM: '[data-item=\"shopping_cart_item\"]',\n    NAVBARCONTAINER: '#nav-shopping_cart-popover-container .shopping-cart-items-container',\n    TRASHCLASS: 'fa-trash-o',\n    DISCOUNTCLASS: 'shoppingcart-discount-icon',\n    MODIFYTIMECLASS: 'shoppingcart-modifytime-icon',\n    BADGECOUNT: '#nav-shopping_cart-popover-container div.count-container',\n    COUNTDOWN: '#nav-shopping_cart-popover-container span.expirationtime',\n    CASHIERSCART: 'div.shopping-cart-cashier-items-container',\n    CHECKOUTCART: 'div.shopping-cart-checkout-items-container',\n    PRICELABELCHECKBOX: '.sc_price_label input.usecredit-checkbox',\n    INSTALLMENTSCHECKBOX: '.sc_price_label input.useinstallments-checkbox',\n    PRICELABELAREA: '.sc_price_label',\n    CHECKOUTBUTTON: '#nav-shopping_cart-popover-container #shopping-cart-checkout-button',\n    PAYMENTREGIONBUTTON: 'div.shopping_cart_payment_region button',\n    ACCEPTTERMS: '#accepttermsandconditions',\n    VATNUMBERVOLUNTARILY: '#vatnumbervoluntarily',\n    CHECKVATNRFORM: 'div.form_vatnrchecker',\n    INCREASEBUTTON: 'increase',\n    DECREASEBUTTON: 'decrease',\n    SHOPPINGCARTITEM: '[data-itemid]',\n};\n/**\n *\n * @param {*} expirationtime\n */\n\nexport const init = (expirationtime, nowdate) => {\n\n    initTimer(expirationtime, nowdate);\n\n    // We might have more than one container.\n    let containers = [];\n    containers = document.querySelectorAll(SELECTORS.NAVBARCONTAINER\n        + \",\" + SELECTORS.CASHIERSCART\n        + \",\" + SELECTORS.CHECKOUTCART);\n\n    containers.forEach(container => {\n\n        container.addEventListener('click', event => {\n\n            // Decide the target of the click.\n            const element = event.target;\n            const parent = element.closest(SELECTORS.SHOPPINGCARTITEM);\n\n            const userid = parent.dataset.userid ? parent.dataset.userid : 0;\n            const component = parent.dataset.component ?? '';\n            const area = parent.dataset.area ?? '';\n            const itemid = parent.dataset.itemid ?? 0;\n\n            if (element.classList.contains(SELECTORS.TRASHCLASS)) {\n                deleteItem(itemid, component, area, userid);\n            } else if (element.classList.contains(SELECTORS.DISCOUNTCLASS)) {\n                discountModal(event);\n            } else if (element.classList.contains(SELECTORS.MODIFYTIMECLASS)) {\n                modifyTimeModal(event);\n            } else if (element.dataset.action == SELECTORS.INCREASEBUTTON) {\n                // eslint-disable-next-line no-console\n                console.log('increase button clicked');\n                event.preventDefault();\n                event.stopPropagation();\n                increaseItem(itemid, component, area, userid);\n            } else if (element.dataset.action == SELECTORS.DECREASEBUTTON) {\n                event.preventDefault();\n                event.stopPropagation();\n                decreaseItem(itemid, component, area, userid);\n            }\n        });\n    });\n\n    // Re-init cart on page reload or navigation to another page - required for 2-digit price precision visibility.\n    document.addEventListener(\"readystatechange\", () => {\n        if (document.readyState !== 'loading') {\n            reinit();\n        }\n    });\n\n    if (visbilityevent == false) {\n        document.addEventListener(\"visibilitychange\", function() {\n            visbilityevent = true;\n            if (document.visibilityState === 'visible') {\n                reinit();\n            }\n        });\n    }\n\n    // Initially, we need to add the zeroPriceListener once.\n    const paymentbutton = document.querySelector(SELECTORS.PAYMENTREGIONBUTTON);\n    if (paymentbutton) {\n        const data = {\n            price: paymentbutton.dataset.price,\n            currency: paymentbutton.dataset.currency,\n        };\n        addZeroPriceListener(data);\n        addCheckoutModalListener();\n    }\n\n    const accepttermsbutton = document.querySelector(SELECTORS.ACCEPTTERMS);\n    if (accepttermsbutton && paymentbutton) {\n        addAcceptTermsListener(accepttermsbutton, paymentbutton);\n    }\n\n    initVATNRChecker();\n};\n\nconst initVATNRChecker = () => {\n\n    const vatnrchecker = document.querySelector(SELECTORS.CHECKVATNRFORM);\n\n    if (vatnrchecker) {\n        const vatnrcheckerform = new DynamicForm(\n            vatnrchecker,\n            'local_shopping_cart\\\\form\\\\dynamicvatnrchecker'\n        );\n\n        vatnrcheckerform.addEventListener('change', (e) => {\n\n            // eslint-disable-next-line no-console\n            console.log(e.target.checked, e.target.name);\n\n            if (!e.target.name) {\n                return;\n            }\n\n            if (e.target.name == 'usevatnr'\n                && e.target.checked === false) {\n\n                // eslint-disable-next-line no-console\n                console.log(e.target.value);\n\n                vatnrcheckerform.submitFormAjax();\n            }\n        });\n\n        // After submitting we want to reload the window to update the rule list.\n        vatnrcheckerform.addEventListener(vatnrcheckerform.events.FORM_SUBMITTED, () => {\n\n            vatnrcheckerform.load();\n            // eslint-disable-next-line no-console\n            console.log('form submitted');\n\n            reinit();\n        });\n    }\n\n};\n\n/**\n * Initializes delegated add-to-cart button handling.\n */\nexport const buttoninit = () => {\n\n    const container = document.querySelector('body'); // or a closer wrapper if known\n    if (!container) {\n        return;\n    }\n\n    // Add one event listener only once\n    if (!container.dataset.cartDelegated) {\n        container.dataset.cartDelegated = 'true';\n\n        container.addEventListener('click', (e) => {\n            const button = e.target.closest(\n                'div[data-objecttable=\"local_shopping_cart\"][data-itemid][data-component][data-area]'\n            );\n            if (!button) {\n                return;\n            }\n\n            // Ensure dataset values\n            const { itemid, component, area } = button.dataset;\n            let userid = button.dataset.userid?.trim() ? button.dataset.userid : 0;\n\n            // Skip nojs buttons\n            if (button.dataset.nojs) {\n                return;\n            }\n\n            // Keep button state up to date\n            toggleActiveButtonState(button);\n\n            // Blocked buttons do nothing\n            if (button.dataset.blocked === 'true') {\n                return;\n            }\n\n            if (button.classList.contains('disabled')) {\n                e.preventDefault();\n                e.stopPropagation();\n                // DeleteItem(itemid, component, area);\n            } else {\n                addItem(itemid, component, area, userid);\n            }\n        });\n    }\n};\n\n/**\n * Function to reload the cart. We can pass on the certain component if we need to make sure that not only the cart is reloaded.\n * This is the case when adding or deleting a certain item and a special button has to be reset.\n * @param {*} userid\n */\nexport const reinit = (userid = 0) => {\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_get_shopping_cart_items\",\n        args: {\n            userid\n        },\n        done: function(data) {\n\n            // If we are on the cashier page, we add the possibility to add a discount to the cart items.\n            const loggedinuserid = M.cfg.userId;\n            const oncashier = (userid != 0 && userid != loggedinuserid);\n\n            if (oncashier > 0) {\n                data.iscashier = true;\n            } else {\n                data.iscashier = false;\n            }\n\n            let containers = [];\n\n            if (userid != 0 && data.iscashier) {\n                containers = document.querySelectorAll(SELECTORS.CASHIERSCART);\n            } else {\n                containers = document.querySelectorAll(SELECTORS.NAVBARCONTAINER\n                    + \",\" + SELECTORS.CHECKOUTCART);\n            }\n\n            let promises = [];\n\n            // Before rendering, we convert all prices to strings with 2 fixed decimals.\n            convertPricesToNumberFormat(data);\n\n            // We render for promise for all the containers.\n            promises.push(Templates.renderForPromise('local_shopping_cart/shopping_cart_items', data).then(({html, js}) => {\n                containers.forEach(container => {\n                    // We know we will always find the Navbar, so we can do this right away.\n                    Templates.replaceNodeContents(container, html, js);\n                });\n                return true;\n            }).catch((e) => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            }));\n\n            Promise.all(promises).then(() => {\n\n                // If we are on the cashier page, we add the possibility to add a discount to the cart items.\n                if (!(userid != 0 && data.iscashier)) {\n                    clearInterval(interval);\n                    initTimer(data.expirationtime, data.nowdate);\n\n                    updateBadge(data.count);\n                }\n\n                toggleActiveButtonState();\n\n                updateTotalPrice(userid);\n\n                return;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n\n        },\n        fail: ex => {\n            // eslint-disable-next-line no-console\n            console.log(\"ex:\" + ex);\n        },\n    }]);\n};\n\n/**\n * This function is only called when the timer invalidates the cart.\n * If no userid is provided the logged in USER will be used.\n * The USER-user is chosen with the userid 0, we just reinit everything after sending.\n * @param {*} userid\n */\nexport const deleteAllItems = (userid = 0) => {\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_all_items_from_cart\",\n        args: {\n            'userid': userid\n        },\n        done: function() {\n            reinit(0);\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(ex);\n        },\n    }]);\n};\n\nexport const deleteItem = (itemid, component, area, userid) => {\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_item\",\n        args: {\n            'itemid': itemid,\n            'component': component,\n            'area': area,\n            'userid': userid\n        },\n        done: function(data) {\n\n            getString('item_deleted', 'local_shopping_cart', data.itemname).then(message => {\n                showNotification(message, 'success');\n                return;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n\n            reinit(userid);\n\n            import('local_wunderbyte_table/reload')\n                // eslint-disable-next-line promise/always-return\n                .then(wbt => {\n                    wbt.reloadAllTables();\n                })\n                .catch(err => {\n                    // Handle any errors, including if the module doesn't exist\n                    // eslint-disable-next-line no-console\n                    console.log(err);\n                });\n\n        },\n        fail: function() {\n\n            reinit(userid);\n        },\n    }]);\n};\n\nexport const addItem = (itemid, component, area, userid) => {\n\n    if (!Number.isInteger(userid)) {\n        userid = parseInt(userid);\n    }\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_add_item\",\n        args: {\n            'area': area,\n            'component': component,\n            'itemid': itemid,\n            'userid': userid\n        },\n        done: function(data) {\n            data.component = component;\n            data.area = area;\n            data.itemid = itemid;\n            data.userid = userid; // For the mustache template, we need to obey structure.\n            addItemShowNotification(data);\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log('error', ex);\n        }\n    }], true);\n};\n\n/**\n *\n * @param {*} userid\n * @param {*} usecredit\n * @param {*} useinstallments\n */\nexport const updateTotalPrice = (userid = 0, usecredit = true, useinstallments = false) => {\n\n    // On cashier, update price must always be for cashier user.\n    const oncashier = window.location.href.indexOf(\"cashier.php\");\n\n    if (oncashier > 0) {\n        const params = new URLSearchParams(window.location.search);\n        userid = params.get(\"userid\") || CASHIERUSER;\n    }\n\n    if (!Number.isInteger(userid)) {\n        userid = parseInt(userid);\n    }\n\n    // We must make sure the checkbox is only once visible on the site.\n    const checkboxes = document.querySelectorAll(SELECTORS.PRICELABELCHECKBOX);\n\n    if (checkboxes.length == 1) {\n        checkboxes.forEach(checkbox => {\n            usecredit = checkbox.checked ? 1 : 0;\n        });\n    } else {\n        usecredit = usecredit ? 1 : 0;\n    }\n\n    const installmentcheckboxes = document.querySelectorAll(SELECTORS.INSTALLMENTSCHECKBOX);\n    if (installmentcheckboxes.length == 1) {\n        installmentcheckboxes.forEach(installmentcheckboxe => {\n            useinstallments = installmentcheckboxe.checked ? 1 : 0;\n        });\n    } else {\n        useinstallments = useinstallments ? 1 : 0;\n    }\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_get_price\",\n        args: {\n            userid,\n            usecredit,\n            useinstallments\n        },\n        done: function(data) {\n\n            // We take the usecredit value we receive from the server.\n            if (data.usecredit == 1) {\n                data.usecreditvalue = 'checked';\n            } else {\n                data.usecreditvalue = '';\n            }\n\n            data.checkboxid = Math.random().toString(36).slice(2, 5);\n\n            if (data.installments.length > 0) {\n                data.installmentscheckboxid = 'i' + data.checkboxid;\n            }\n\n            data.userid = userid;\n\n            const labelareas = document.querySelectorAll(SELECTORS.PRICELABELAREA);\n\n            // Before rendering, we convert all prices to strings with 2 fixed decimals.\n            convertPricesToNumberFormat(data);\n\n            Templates.renderForPromise('local_shopping_cart/price_label', data).then(({html, js}) => {\n\n                labelareas.forEach(labelarea => {\n\n                    // There are labelareas we don't want to update.\n                    if (!labelarea.dataset.noupdate) {\n                        Templates.replaceNodeContents(labelarea, html, js);\n                        addZeroPriceListener(data);\n                    }\n                });\n\n                return true;\n            }).catch((e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            }));\n\n            const checkoutButton = document.querySelector(SELECTORS.CHECKOUTBUTTON);\n            const paymentbutton = document.querySelector(SELECTORS.PAYMENTREGIONBUTTON);\n            if (data.count == 0) {\n                if (checkoutButton) {\n                    checkoutButton.classList.add(\"disabled\");\n                }\n                if (paymentbutton) {\n                    paymentbutton.style.display = \"none\";\n                }\n            } else {\n                if (checkoutButton) {\n                    checkoutButton.classList.remove(\"disabled\");\n                }\n                if (paymentbutton) {\n                    paymentbutton.style.display = \"inline\";\n                }\n            }\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log('error', ex);\n        }\n    }], true);\n};\n\n/**\n * Looks for the payment buttun, updates cost and adds the listener.\n * @param {*} data\n */\nexport function addZeroPriceListener(data) {\n\n    let paymentbutton = document.querySelector(SELECTORS.PAYMENTREGIONBUTTON);\n\n    if (paymentbutton) {\n\n        if (paymentbutton.classList.contains('disabled')) {\n            // eslint-disable-next-line no-console\n            console.log('button disabled');\n            return;\n        }\n\n        const price = data.price;\n        const currency = data.currency;\n\n        paymentbutton.dataset.cost = price + \" \" + currency;\n\n        if (price == 0) {\n            paymentbutton.addEventListener('click', dealWithZeroPrice);\n        } else {\n            paymentbutton.removeEventListener('click', dealWithZeroPrice);\n        }\n    }\n}\n\n/**\n * Adds a clicklistener to all elements closing the modal to refresh the page when payment process is interupted.\n */\nexport function addCheckoutModalListener() {\n    document.body.addEventListener(\"click\", function(event) {\n\n        const target = event.target;\n        // Check if click is on the modal backdrop\n        const isModalBackground = target.dataset.region === \"modal-container\"\n            && target.classList.contains(\"hide\");\n\n        // Find the closest button (important for 'hide' action inside a button)\n        const closestButton = target.closest(\"button[data-action='hide']\");\n        // Check if click is on an element inside modal that triggers closing\n        const isCloseAction =\n            target.closest('[data-region=\"modal-container\"]') &&\n            (closestButton || target.dataset.action === \"cancel\");\n\n        if (isModalBackground || isCloseAction) {\n            setTimeout(() => {\n                location.reload();\n            }, 300); // Small delay to ensure modal closes before refresh\n        }\n    });\n}\n\n/**\n * Function to show notifications when items are added.\n * @param {*} data\n */\nexport function addItemShowNotification(data) {\n    const CARTPARAM_ALREADYINCART = 0; // Already in cart.\n    const CARTPARAM_SUCCESS = 1; // Item added to cart successfully.\n    const CARTPARAM_CARTISFULL = 2; // Item added to cart successfully.\n    const CARTPARAM_COSTCENTER = 3; // Item added to cart successfully.\n    const CARTPARAM_FULLYBOOKED = 4; // Item not added because item is already fully booked.\n    const CARTPARAM_ALREADYBOOKED = 5; // Item not added because item was already booked before.\n    const CARTPARAM_PAYMENTACCOUNT = 6; // Item could not be added because of different payment accounts.\n\n    switch (data.success) {\n        case CARTPARAM_ALREADYINCART:\n            reinit();\n            return;\n        case CARTPARAM_SUCCESS:\n            getString('addedtocart', 'local_shopping_cart', data.itemname).then(message => {\n                showNotification(message, 'success');\n                return;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            reinit(data.userid);\n            return;\n        case CARTPARAM_CARTISFULL:\n            getStrings([\n                {key: 'cartisfull', component: 'local_shopping_cart'},\n                {key: 'ok', component: 'core'},\n            ]).then(strings => {\n                // eslint-disable-next-line promise/no-nesting\n                ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n                    modal.setBody(strings[0]);\n                    modal.setSaveButtonText(strings[1]);\n                    modal.show();\n                    return modal;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            return;\n        case CARTPARAM_COSTCENTER:\n            getStrings([\n                {key: 'error:costcentertitle', component: 'local_shopping_cart'},\n                {key: 'error:costcentersdonotmatch', component: 'local_shopping_cart'},\n                {key: 'ok', component: 'core'},\n            ]).then(strings => {\n                // eslint-disable-next-line promise/no-nesting\n                ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n                    modal.setTitle(strings[0]);\n                    modal.setBody(strings[1]);\n                    modal.setSaveButtonText(strings[2]);\n                    modal.show();\n                    return modal;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            return;\n        case CARTPARAM_FULLYBOOKED:\n            getStrings([\n                {key: 'error:fullybookedtitle', component: 'local_shopping_cart'},\n                {key: 'error:fullybooked', component: 'local_shopping_cart'},\n                {key: 'ok', component: 'core'},\n            ]).then(strings => {\n                // eslint-disable-next-line promise/no-nesting\n                ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n                    modal.setTitle(strings[0]);\n                    modal.setBody(strings[1]);\n                    modal.setSaveButtonText(strings[2]);\n\n                    // Reload when OK button is clicked.\n                    modal.getRoot().on(ModalEvents.save, function() {\n                        window.location.reload();\n                    });\n\n                    modal.show();\n                    return modal;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            return;\n        case CARTPARAM_ALREADYBOOKED:\n            getStrings([\n                {key: 'error:alreadybookedtitle', component: 'local_shopping_cart'},\n                {key: 'error:alreadybooked', component: 'local_shopping_cart'},\n                {key: 'ok', component: 'core'},\n            ]).then(strings => {\n                // eslint-disable-next-line promise/no-nesting\n                ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n                    modal.setTitle(strings[0]);\n                    modal.setBody(strings[1]);\n                    modal.setSaveButtonText(strings[2]);\n\n                    // Reload when OK button is clicked.\n                    modal.getRoot().on(ModalEvents.save, function() {\n                        window.location.reload();\n                    });\n\n                    modal.show();\n                    return modal;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            return;\n        case CARTPARAM_PAYMENTACCOUNT:\n            getStrings([\n                {key: 'error:paymentaccounttitle', component: 'local_shopping_cart'},\n                {key: 'error:paymentaccountsdonotmatch', component: 'local_shopping_cart'},\n                {key: 'ok', component: 'core'},\n            ]).then(strings => {\n                // eslint-disable-next-line promise/no-nesting\n                ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n                    modal.setTitle(strings[0]);\n                    modal.setBody(strings[1]);\n                    modal.setSaveButtonText(strings[2]);\n                    modal.show();\n                    return modal;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            return;\n        default:\n            getStrings([\n                {key: 'error:generalcarterror', component: 'local_shopping_cart'},\n                {key: 'ok', component: 'core'},\n            ]).then(strings => {\n                // eslint-disable-next-line promise/no-nesting\n                ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n                    modal.setBody(strings[0]);\n                    modal.setSaveButtonText(strings[1]);\n                    modal.show();\n                    return modal;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            return;\n    }\n\n}\n\n/**\n *\n * @param {*} event\n */\nasync function dealWithZeroPrice(event) {\n\n    event.stopPropagation();\n    event.preventDefault();\n\n    confirmZeroPriceCheckoutModal(event.target);\n}\n\n/**\n * Start the timer.\n *\n * @param {integer} duration\n * @param {integer} display\n */\nfunction startTimer(duration, display) {\n\n    var timer = duration,\n        minutes,\n        seconds;\n    interval = setInterval(function() {\n\n        minutes = parseInt(timer / 60, 10);\n        seconds = parseInt(timer % 60, 10);\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        display.textContent = minutes + \":\" + seconds;\n\n        if (--timer < 0) {\n\n            // We so the expiration time has already kicked in on the server.\n            setTimeout(() => {\n                reinit(0);\n            }, 2000);\n\n            // We don't actually need to make this call.\n            // deleteAllItems();\n\n            clearInterval(interval);\n        }\n    }, 1000);\n}\n\n/**\n * Initialize Timer.\n *\n * @param {integer} expirationtime\n * @param {integer} nowdate\n *\n */\nfunction initTimer(expirationtime = null, nowdate = null) {\n\n    const countdownelement = document.querySelector(SELECTORS.COUNTDOWN);\n\n    if (!countdownelement || !nowdate) {\n        return;\n    }\n\n    if (interval) {\n        clearInterval(interval);\n    }\n    let delta = 0;\n    let now = nowdate;\n    if (expirationtime) {\n        delta = (expirationtime - now);\n    }\n    if (delta <= 0) {\n        delta = 0;\n        countdownelement.classList.add(\"hidden\");\n    } else if (delta > 0) {\n        countdownelement.classList.remove(\"hidden\");\n        startTimer(delta, countdownelement);\n    }\n}\n\n/**\n *\n * @param {*} element\n */\nfunction confirmZeroPriceCheckoutModal(element) {\n\n    getStrings([\n        {key: 'confirmzeropricecheckouttitle', component: 'local_shopping_cart'},\n        {key: 'confirmzeropricecheckoutbody', component: 'local_shopping_cart'},\n        {key: 'confirmzeropricecheckout', component: 'local_shopping_cart'}\n    ]\n    ).then(strings => {\n        // eslint-disable-next-line promise/no-nesting\n        ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n\n            modal.setTitle(strings[0]);\n            modal.setBody(strings[1]);\n            modal.setSaveButtonText(strings[2]);\n            modal.getRoot().on(ModalEvents.save, function() {\n\n                const userid = element.dataset.userid;\n\n                if (userid) {\n                    // The second parameter designs the payment method.\n                    // In the cart, the constant PAYMENT_METHOD_CREDITS translates to 2.\n                    confirmPayment(userid, 2);\n                }\n            });\n\n            modal.show();\n            return modal;\n        }).catch(e => {\n            // eslint-disable-next-line no-console\n            console.log(e);\n        });\n        return true;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n}\n\n/**\n * Function to update the page in the nav bar.\n * @param {*} count\n */\nfunction updateBadge(count) {\n\n    const badge = document.querySelector(SELECTORS.BADGECOUNT);\n\n    if (count > 0) {\n        badge.innerHTML = count;\n        badge.classList.remove('hidden');\n    } else {\n        badge.innerHTML = count;\n        badge.classList.add('hidden');\n    }\n}\n\n/**\n * Function to toggle the active state.\n * @param {*} button\n */\nfunction toggleActiveButtonState(button = null) {\n\n    let selector = '';\n    let component = null;\n    let area = null;\n    let itemid = null;\n\n    // If we have a button, we only look for this particular itemid.\n    if (button) {\n\n        // We'll find the right variables in the DOM.\n        itemid = button.dataset.itemid;\n        component = button.dataset.component;\n        area = button.dataset.area;\n\n        selector =\n            'div'\n            + '[data-itemid=\"' + itemid + '\"]'\n            + '[data-component=\"' + component + '\"]'\n            + '[data-area=\"' + area + '\"]'\n            + '[data-objecttable=\"local_shopping_cart\"';\n    } else {\n        // As we might have more than one of these buttons, we always need to look for all of them in the document.\n        // We will update for all the buttons we find.\n        selector =\n            'div'\n            + '[data-objecttable=\"local_shopping_cart\"';\n    }\n\n    const buttons = document.querySelectorAll(selector);\n\n    // Make sure item is not yet in shopping cart. If so, add disabled class.\n    let shoppingcart = document.querySelector(SELECTORS.CASHIERSCART);\n\n    if (!shoppingcart) {\n        shoppingcart = document.querySelector(SELECTORS.NAVBARCONTAINER);\n    }\n\n    buttons.forEach(addtocartbutton => {\n\n        component = addtocartbutton.dataset.component;\n        area = addtocartbutton.dataset.area;\n        itemid = addtocartbutton.dataset.itemid;\n\n        const cartitem = shoppingcart.querySelector('[id=\"item-' + component + '-' + area + '-' + itemid + '\"]');\n\n        if (cartitem) {\n\n            addtocartbutton.classList.add('disabled');\n        } else {\n\n            addtocartbutton.classList.remove('disabled');\n        }\n    });\n}\n\n/**\n * Function to init Price Label and add Listener.\n * @param {*} userid\n */\nexport function initPriceLabel(userid) {\n\n    if (userid < 1) {\n        userid = 0;\n    }\n\n    const checkbox = document.querySelector(SELECTORS.PRICELABELCHECKBOX);\n    const installmentscheckbox = document.querySelector(SELECTORS.INSTALLMENTSCHECKBOX);\n\n    if (checkbox && !checkbox.initialized) {\n        checkbox.initialized = true;\n        checkbox.addEventListener('change', event => {\n\n            var installementsvalue = false;\n            if (installmentscheckbox) {\n                installementsvalue = installmentscheckbox.checked;\n            }\n\n            if (event.currentTarget.checked) {\n                updateTotalPrice(userid, true, installementsvalue);\n            } else {\n                updateTotalPrice(userid, false, installementsvalue);\n            }\n        });\n    }\n\n    if (installmentscheckbox && !installmentscheckbox.initialized) {\n        installmentscheckbox.initialized = true;\n\n        // eslint-disable-next-line no-console\n        console.log('add event listener to installment');\n        installmentscheckbox.addEventListener('change', event => {\n\n            // eslint-disable-next-line no-console\n            console.log(event.currentTarget, event.currentTarget.checked);\n\n            // eslint-disable-next-line no-console\n            console.log(checkbox);\n\n            let checkboxchecked = null;\n            if (checkbox) {\n                checkboxchecked = checkbox.checked;\n            }\n\n            updateTotalPrice(userid, checkboxchecked, event.currentTarget.checked);\n\n        });\n    }\n}\n\n/**\n * Helper function to convert prices to number format before rendering.\n * @param {Object} data the data containing the price values\n */\nfunction convertPricesToNumberFormat(data) {\n    // Create a formatter based on the current language of the user.\n    const formatter = new Intl.NumberFormat(data.lang, {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n    });\n    /**\n     * Formats a number using the Intl.NumberFormat instance.\n     * @param {number} value - The value to format.\n     * @returns {string} The formatted number.\n     */\n    function formatNumber(value) {\n        // Convert the value to a number and then format it\n        const numberValue = Number(value);\n        return formatter.format(numberValue);\n    }\n\n    if (data.price) {\n        data.price = formatNumber(data.price);\n    }\n    if (data.initialtotal) {\n        data.initialtotal = formatNumber(data.initialtotal);\n    }\n    if (data.initialtotal_net) {\n        data.initialtotal_net = formatNumber(data.initialtotal_net);\n    }\n    if (data.discount) {\n        data.discount = formatNumber(data.discount);\n    }\n    if (data.deductible) {\n        data.deductible = formatNumber(data.deductible);\n    }\n    if (data.credit) {\n        data.credit = formatNumber(data.credit);\n    }\n    if (data.remainingcredit) {\n        data.remainingcredit = formatNumber(data.remainingcredit);\n    }\n    if (data.price_net) {\n        data.price_net = formatNumber(data.price_net);\n    }\n    if (data.price_gross) {\n        data.price_gross = formatNumber(data.price_gross);\n    }\n    if (data.items) {\n        for (var i = 0; i < data.items.length; i++) {\n            if (data.items[i].price) {\n                data.items[i].price = formatNumber(data.items[i].price);\n            }\n            if (data.items[i].price_gross) {\n                data.items[i].price_gross = formatNumber(data.items[i].price_gross);\n            }\n            if (data.items[i].price_net) {\n                data.items[i].price_net = formatNumber(data.items[i].price_net);\n            }\n        }\n    }\n}\n\n/**\n * Add Accept terms listener to set the right class to payment region button.\n * @param {element} accepttermsbutton\n * @param {element} paymentbutton\n */\nfunction addAcceptTermsListener(accepttermsbutton, paymentbutton) {\n\n    accepttermsbutton.addEventListener('change', event => {\n        if (event.currentTarget.checked) {\n            paymentbutton.disabled = false;\n        } else {\n            paymentbutton.disabled = true;\n        }\n    });\n}\n\n/**\n * Triggers the ajax call to increase the number of items in the cart.\n *\n * @param {int} itemid\n * @param {string} component\n * @param {string} area\n * @param {int} userid\n *\n * @return [type]\n *\n */\nfunction increaseItem(itemid, component, area, userid) {\n\n    // eslint-disable-next-line no-console\n    console.log(itemid, component, area, userid);\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_increase_number_of_item\",\n        args: {\n            'itemid': itemid,\n            'component': component,\n            'area': area,\n            'userid': userid\n        },\n        done: function() {\n            /* Commented out:\n            function(data) {\n            getString('item_deleted', 'local_shopping_cart', data.itemname).then(message => {\n                showNotification(message, 'success');\n                return;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            }); */\n            reinit(userid);\n        },\n        fail: function() {\n            // eslint-disable-next-line no-console\n            console.log('fail');\n            reinit(userid);\n        },\n    }]);\n}\n\n/**\n * Triggers the ajax call to decrease the number of items in the cart.\n *\n * @param {int} itemid\n * @param {string} component\n * @param {string} area\n * @param {int} userid\n *\n * @return [type]\n *\n */\nfunction decreaseItem(itemid, component, area, userid) {\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_decrease_number_of_item\",\n        args: {\n            'itemid': itemid,\n            'component': component,\n            'area': area,\n            'userid': userid\n        },\n        done: function() {\n            /* Commented out:\n            function(data) {\n            getString('item_deleted', 'local_shopping_cart', data.itemname).then(message => {\n                showNotification(message, 'success');\n                return;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            }); */\n            reinit(userid);\n        },\n        fail: function() {\n\n            reinit(userid);\n        },\n    }]);\n}"],"names":["userid","checkbox","document","querySelector","SELECTORS","installmentscheckbox","initialized","addEventListener","event","installementsvalue","checked","currentTarget","updateTotalPrice","console","log","checkboxchecked","interval","visbilityevent","expirationtime","nowdate","initTimer","containers","querySelectorAll","forEach","container","element","target","parent","closest","dataset","component","area","itemid","classList","contains","deleteItem","action","preventDefault","stopPropagation","call","methodname","args","done","reinit","fail","increaseItem","decreaseItem","readyState","visibilityState","paymentbutton","addZeroPriceListener","price","currency","addCheckoutModalListener","accepttermsbutton","disabled","addAcceptTermsListener","initVATNRChecker","vatnrchecker","vatnrcheckerform","DynamicForm","e","name","value","submitFormAjax","events","FORM_SUBMITTED","load","cartDelegated","button","trim","nojs","toggleActiveButtonState","blocked","addItem","data","loggedinuserid","M","cfg","userId","oncashier","iscashier","promises","convertPricesToNumberFormat","push","Templates","renderForPromise","then","_ref","html","js","replaceNodeContents","catch","Promise","all","clearInterval","updateBadge","count","ex","itemname","message","wbt","reloadAllTables","err","Number","isInteger","parseInt","addItemShowNotification","usecredit","useinstallments","window","location","href","indexOf","params","URLSearchParams","search","get","checkboxes","length","installmentcheckboxes","installmentcheckboxe","usecreditvalue","checkboxid","Math","random","toString","slice","installments","installmentscheckboxid","labelareas","_ref2","labelarea","noupdate","checkoutButton","add","style","display","remove","cost","dealWithZeroPrice","removeEventListener","body","isModalBackground","region","closestButton","isCloseAction","setTimeout","reload","success","key","strings","create","type","ModalFactory","types","SAVE_CANCEL","modal","setBody","setSaveButtonText","show","setTitle","getRoot","on","ModalEvents","save","startTimer","duration","minutes","seconds","timer","setInterval","textContent","countdownelement","delta","now","badge","innerHTML","selector","buttons","shoppingcart","addtocartbutton","formatter","Intl","NumberFormat","lang","minimumFractionDigits","maximumFractionDigits","formatNumber","numberValue","format","initialtotal","initialtotal_net","discount","deductible","credit","remainingcredit","price_net","price_gross","items","i"],"mappings":"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"}