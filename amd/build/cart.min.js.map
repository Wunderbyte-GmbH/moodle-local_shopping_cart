{"version":3,"sources":["../src/cart.js"],"names":["init","document","querySelectorAll","forEach","item","addEventListener","event","preventDefault","stopPropagation","element","querySelector","dataset","id","itemprice","price","total","getElementById","innerHTML","split","pop","deleteItem","remove","console","log","addItem","Ajax","call","methodname","args","done","fail","data","html","name","lastElem","insertAdjacentHTML","parseInt","addDeleteevent","setTimer","expirationdate","startTimer","duration","display","timer","minutes","seconds","setInterval","textContent","delta","now","Date","getTime"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_shopping_cart\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\n\n/**\n * Gets called from mustache template.\n *\n */\nexport const init = () => {\n    document.querySelectorAll('.fa-trash-o').forEach(item => {\n        item.addEventListener('click', event => {\n          event.preventDefault();\n          event.stopPropagation();\n          let element = document.querySelector('#' + item.dataset.id);\n          let itemprice = element.dataset.price;\n          let total = document.getElementById('totalprice');\n          total.innerHTML -= itemprice; \n          let id = item.dataset.id.split('-').pop();\n          deleteItem(id);\n          document.querySelector('#' + item.dataset.id).remove();\n          document.getElementById(\"countbadge\").innerHTML -= 1;\n          document.getElementById(\"itemcount\").innerHTML -= 1;\n        })\n      })\n    document.querySelector('#nav-shopping_cart-popover-container .btn-primary.addrandom').addEventListener('click', event => {\n        console.log(\"click\");\n        event.preventDefault();\n        event.stopPropagation();\n        addItem();\n    }) \n};\n\n\nexport const deleteItem = (id) => {\n    Ajax.call([{\n        methodname: \"local_shopping_cart_delete_item\",\n        args: {\n            'id': id,\n        },\n        done: function() {\n        },\n        fail: function(ex) {\n        },\n    }]);   \n}\n\nexport const addItem = () => {\n    console.log(\"deletestart\");\n    Ajax.call([{\n        methodname: \"local_shopping_cart_add_item\",\n        args: {\n            'id': '1',\n        },\n        done: function(data) {\n           let html = '<li id=\"item-' + data.id + '\" class=\"clearfix\" data-price=\"' + data.price + '\" data-name=\"' + data.name + '\">' +\n            '<span class=\"item-name\"><i class=\"fa fa-futbol-o\" aria-hidden=\"true\"></i>' + data.name + '</span>' +\n            '<span class=\"item-price pull-right\">' + data.price + 'â‚¬</span><br>' +\n           '<span class=\"item-time pl-3\">[<span id=\"time-item-' + data.id + '\"></span>]</span>' +\n            '<span class=\"pull-right\"><i class=\"fa fa-trash-o lighter-text\" data-id=\"item-' + data.id + '\"></i></span>' +\n            '</li>';\n            let lastElem = document.getElementById('litotalprice');\n            lastElem.insertAdjacentHTML('beforeBegin', html);\n            document.getElementById(\"countbadge\").innerHTML ++;\n            document.getElementById(\"itemcount\").innerHTML ++;\n            let total = document.getElementById('totalprice');\n            total.innerHTML = parseInt(total.innerHTML) + parseInt(data.price);\n            addDeleteevent(document.querySelector('#item-' + data.id + ' .fa-trash-o'));\n            setTimer(data.expirationdate, data.id)\n        },\n        fail: function(ex) {\n        } \n    }], true);\n}; \n\n/**\n * Add Events.\n */\n\nfunction addDeleteevent(item) {\n    item.addEventListener('click', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        let element = document.querySelector('#' + item.dataset.id);\n        let itemprice = element.dataset.price;\n        let total = document.getElementById('totalprice');\n        total.innerHTML -= itemprice; \n        let id = item.dataset.id.split('-').pop();\n        deleteItem(id);\n        document.querySelector('#' + item.dataset.id).remove();\n        document.getElementById(\"countbadge\").innerHTML -= 1;\n        document.getElementById(\"itemcount\").innerHTML -= 1;\n    })\n}\n\n\nfunction startTimer(duration, display) {\n    var timer = duration, minutes, seconds;\n    setInterval(function () {\n        minutes = parseInt(timer / 60, 10);\n        seconds = parseInt(timer % 60, 10);\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n        display.textContent = minutes + \":\" + seconds;\n\n        if (--timer < 0) {\n            timer = duration;\n        }\n    }, 1000);\n}\n\nfunction setTimer(expirationdate, id) {\n    let delta = 0;\n    let now = Date.now('UTC');\n    now = (new Date()).getTime() / 1000;\n    delta = (expirationdate - now);\n    if (delta < 0) {\n    delta = 0;\n    }\n    let display = document.querySelector('#time-item-' + id);\n    startTimer(delta, display);\n}\n"],"file":"cart.min.js"}