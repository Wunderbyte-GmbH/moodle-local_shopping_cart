define ("local_shopping_cart/shistory",["exports","core/ajax","core/str","core/notification","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=g(b);d=g(d);e=g(e);f=g(f);function g(a){return a&&a.__esModule?a:{default:a}}a.init=function init(){var a=document.querySelectorAll("#shopping_cart-cashiers-section .shopping_cart_history_cancel_button");a.forEach(function(a){if(!a.dataset.initialized){console.log(a.dataset.canceled,a.dataset.historyid);if(!0==a.dataset.canceled){i(a)}else{a.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();if(!1==a.dataset.canceled){console.log("button clicked");j(a)}})}a.dataset.initialized=!0}})};function h(a,e,f,g,h){console.log("button clicked",g);b.default.call([{methodname:"local_shopping_cart_cancel_purchase",args:{itemid:a,componentname:f,userid:e,historyid:g},done:function done(a){if(1==a.success){(0,c.get_string)("cancelsuccess","local_shopping_cart").then(function(a){d.default.addNotification({message:a,type:"success"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert"),b=a[a.length-1];b.remove()},5e3)}).catch(function(a){console.log(a)});console.log("data returned",a.success);i(h)}else{(0,c.get_string)("canceldidntwork","local_shopping_cart").then(function(a){d.default.addNotification({message:a,type:"danger"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert"),b=a[a.length-1];b.remove()},5e3)}).catch(function(a){console.log(a)})}},fail:function fail(a){console.log("ex:"+a)}}])}function i(a){a.classList.add("disabled");a.classList.remove("btn-primary");a.classList.add("btn-danger");a.dataset.canceled=!0;(0,c.get_string)("canceled","local_shopping_cart").then(function(b){console.log(b);a.innerText=b}).catch(function(a){console.log(a)})}function j(a){(0,c.get_strings)([{key:"confirmcanceltitle",component:"local_shopping_cart"},{key:"confirmcancelbody",component:"local_shopping_cart"},{key:"cancelpurchase",component:"local_shopping_cart"}]).then(function(b){e.default.create({type:e.default.types.SAVE_CANCEL}).then(function(c){c.setTitle(b[0]);c.setBody(b[1]);c.setSaveButtonText(b[2]);c.getRoot().on(f.default.save,function(){console.log("we saved");var b=a.dataset.historyid,c=a.dataset.itemid,d=a.dataset.userid,e=a.dataset.componentname;h(c,d,e,b,a)});c.show();return c}).catch(function(a){console.log(a)});return!0}).catch(function(a){console.log(a)})}});
//# sourceMappingURL=shistory.min.js.map
