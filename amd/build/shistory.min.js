define ("local_shopping_cart/shistory",["exports","core/ajax","core/templates","local_shopping_cart/cart","core/str","core/notification","core/modal_factory","core/modal_events","core_form/modalform"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=j(b);c=j(c);f=j(f);g=j(g);h=j(h);i=j(i);function j(a){return a&&a.__esModule?a:{default:a}}var q=function(){var a=document.querySelectorAll("#shopping_cart-cashiers-section .shopping_cart_history_cancel_button");a.forEach(function(a){if(!a.dataset.initialized){if(!0==a.dataset.canceled){l(a)}else{a.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();if(!1==a.dataset.canceled){console.log("button clicked");o(a)}})}a.dataset.initialized=!0}});var b=document.querySelectorAll("button.shopping_cart_history_paidback_button");b.forEach(function(a){console.log("initialize paid back",a);if(!a.dataset.initialized){a.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();console.log("button clicked");p(a)});a.dataset.initialized=!0}})};a.init=q;function k(a,g,h,i,j,k,n,o){console.log("button clicked",i);b.default.call([{methodname:"local_shopping_cart_cancel_purchase",args:{itemid:a,componentname:h,userid:g,historyid:i,credit:n},done:function done(b){console.log(b);if(1==b.success){(0,e.get_string)("cancelsuccess","local_shopping_cart").then(function(a){f.default.addNotification({message:a,type:"success"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert"),b=a[a.length-1];b.remove()},5e3)}).catch(function(a){console.log(a)});console.log("data returned",b.success);l(o);m(b.credit,j,g);var i=document.querySelector("#btn-"+h+"-"+a);if(!i){b.itemid=a;b.componentname=h;b.price=k;c.default.renderForPromise("local_shopping_cart/addtocartdb",b).then(function(b){var c=b.html,e=document.querySelector("span.price_"+h+"_"+a);e.textContent=k+" "+j;if(e){e.insertAdjacentHTML("beforeend",c)}(0,d.buttoninit)(a,h);return!0}).catch(function(a){console.log(a)})}else{console.log(i);i.classList.remove("disabled");i.dataset.initialized=!1;(0,d.buttoninit)(a,h)}}else{(0,e.get_string)("canceldidntwork","local_shopping_cart").then(function(a){f.default.addNotification({message:a,type:"danger"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert"),b=a[a.length-1];b.remove()},5e3)}).catch(function(a){console.log(a)})}},fail:function fail(a){console.log("ex:"+a)}}])}function l(a){a.classList.add("disabled");a.classList.remove("btn-primary");a.classList.add("btn-danger");a.dataset.canceled=!0;(0,e.get_string)("canceled","local_shopping_cart").then(function(b){console.log(b);a.innerText=b}).catch(function(a){console.log(a)})}function m(a,b,e){var f=document.querySelector("li.shopping_cart_history_paidback");if(f){f.classList.remove("hidden");var g=f.querySelector("span.credit_total");g.textContent=a}else{c.default.renderForPromise("local_shopping_cart/credit_item",{currency:b,credit:a,userid:e}).then(function(a){var b=a.html,c=document.querySelector("ul.cashier-history-items");c.insertAdjacentHTML("afterbegin",b);q();return!0}).catch(function(a){console.log(a)})}(0,d.updateTotalPrice)()}function n(a){var c=a.dataset.userid;b.default.call([{methodname:"local_shopping_cart_credit_paid_back",args:{userid:c},done:function done(a){console.log(a,c);var b=document.querySelector(".credit_total");b.textContent=0;var e=document.querySelector(".shopping_cart_history_paidback");e.classList.add("hidden");f.default.addNotification({message:"Credit paid back",type:"success"});setTimeout(function(){var a=document.querySelectorAll("#user-notifications div.alert.alert-success"),b=a[a.length-1];b.remove()},5e3);(0,d.updateTotalPrice)()},fail:function fail(a){console.log("ex:"+a)}}])}function o(a){var b=a.dataset.price,c=new i.default({formClass:"local_shopping_cart\\form\\modal_cancel_addcredit",args:{credit:b},modalConfig:{title:(0,e.get_string)("confirmcanceltitle","local_shopping_cart")},returnFocus:a});c.addEventListener(c.events.FORM_SUBMITTED,function(c){var d;window.console.log(c.detail);var e=a.dataset.historyid,f=a.dataset.itemid,g=a.dataset.userid,h=a.dataset.currency,i=a.dataset.componentname,j=null!==(d=c.detail.credit)&&void 0!==d?d:"";k(f,g,i,e,h,b,j,a)});c.show()}function p(a){(0,e.get_strings)([{key:"confirmpaidbacktitle",component:"local_shopping_cart"},{key:"confirmpaidbackbody",component:"local_shopping_cart"},{key:"confirmpaidback",component:"local_shopping_cart"}]).then(function(b){g.default.create({type:g.default.types.SAVE_CANCEL}).then(function(c){c.setTitle(b[0]);c.setBody(b[1]);c.setSaveButtonText(b[2]);c.getRoot().on(h.default.save,function(){console.log("we saved");n(a)});c.show();return c}).catch(function(a){console.log(a)});return!0}).catch(function(a){console.log(a)})}});
//# sourceMappingURL=shistory.min.js.map
