{"version":3,"sources":["../src/cachier.js"],"names":["init","users","document","addEventListener","getElementById","classList","add","e","querySelector","preventDefault","stopPropagation","confirmPayment","autocomplete","input","filter","value","toUpperCase","li","querySelectorAll","i","length","a","txtValue","textContent","innerText","indexOf","style","display","userid","Ajax","call","methodname","args","done","data","success","console","log","fail","ex","validateCart","$userid","alert","inp","arr","currentFocus","useridfield","b","val","closeAllLists","createElement","setAttribute","id","parentNode","appendChild","substr","innerHTML","getElementsByTagName","split","x","keyCode","addActive","click","removeActive","remove","elmnt","getElementsByClassName","removeChild","target"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_shopping_cart\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\n\nexport const init = (users) => {\n    document.addEventListener(\"DOMContentLoaded\", function() {\n        document.getElementById('buy-btn').addEventListener('click', function() {\n            document.getElementById('success-tab').classList.add('success');\n        });\n\n        document.getElementById('checkout-btn').addEventListener('click', function(e) {\n            if (!document.querySelector(\".shopping-cart-items [id^='item']\")) {\n                document.getElementById('checkout-tab').classList.add('success');\n            } else {\n                e.preventDefault();\n                e.stopPropagation();\n\n                confirmPayment();\n            }\n        });\n     });\n     autocomplete(document.getElementById(\"myInput\"), users);\n\n     attachFilterFuntion();\n\n     /**\n      * Attach filter function.\n      */\n    function attachFilterFuntion() {\n        const input = document.querySelector(\"#shoppingcartfilterinput\");\n        input.addEventListener(\"keyup\", () => {\n            const filter = input.value.toUpperCase();\n            const li = document.querySelectorAll(\".list-group-item.wunderbyteTableJavascript\");\n            for (let i = 0; i < li.length; i++) {\n                const a = li[i];\n                const txtValue = a.textContent || a.innerText;\n                if (txtValue.toUpperCase().indexOf(filter) > -1) {\n                    li[i].style.display = \"\";\n                } else {\n                    li[i].style.display = \"none\";\n                }\n            }\n        });\n    }\n\n    /**\n     * Confirm successful payment via ajax.\n     * @param {integer} userid\n     */\n    function confirmPayment(userid) {\n        Ajax.call([{\n            methodname: \"local_shopping_cart_confirm_payment\",\n            args: {\n                'userid': userid\n            },\n            done: function(data) {\n\n                if (data.success == 1) {\n                    // eslint-disable-next-line no-console\n                    console.log('payment confirmed');\n                } else {\n                    // eslint-disable-next-line no-console\n                    console.log('payment denied');\n                }\n            },\n            fail: function(ex) {\n                // eslint-disable-next-line no-console\n                console.log(ex);\n            },\n        }]);\n    }\n};\n\nexport const validateCart = ($userid) => {\n    // eslint-disable-next-line no-alert\n    alert($userid);\n };\n\n/**\n * The autocomplete function takes two arguments.\n * The text field element and an array of possible autocompleted values.\n * @param {string} inp\n * @param {array} arr\n */\n export const autocomplete = (inp, arr) => {\n\n    var currentFocus;\n    const useridfield = document.querySelector('#useridfield');\n    inp.addEventListener(\"input\", function() {\n        var a, b, i, val = this.value;\n        closeAllLists();\n        if (!val) {\n            return false;\n        }\n        currentFocus = -1;\n        a = document.createElement(\"DIV\");\n        a.setAttribute(\"id\", this.id + \"autocomplete-list\");\n        a.setAttribute(\"class\", \"autocomplete-items\");\n        this.parentNode.appendChild(a);\n        for (i = 0; i < arr.length; i++) {\n            if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {\n                b = document.createElement(\"DIV\");\n                b.innerHTML = \"<strong>\" + arr[i].substr(0, val.length) + \"</strong>\";\n                b.innerHTML += arr[i].substr(val.length);\n                b.innerHTML += \"<input type='hidden' value='\" + arr[i] + \"'>\";\n                b.addEventListener(\"click\", function() {\n                    inp.value = this.getElementsByTagName(\"input\")[0].value;\n                    useridfield.value = this.getElementsByTagName(\"input\")[0].value.split('uid:')[1];\n                    closeAllLists();\n                });\n                a.appendChild(b);\n            }\n        }\n    });\n\n    inp.addEventListener(\"keydown\", function(e) {\n        var x = document.getElementById(this.id + \"autocomplete-list\");\n        if (x) {\n            x = x.getElementsByTagName(\"div\");\n        }\n        if (e.keyCode == 40) {\n          currentFocus++;\n          addActive(x);\n        } else if (e.keyCode == 38) {\n          currentFocus--;\n          addActive(x);\n        } else if (e.keyCode == 13) {\n          e.preventDefault();\n          if (currentFocus > -1) {\n            if (x) {\n                x[currentFocus].click();\n            }\n          }\n        }\n    });\n\n    /**\n     * Add active.\n     * @param {*} x\n     */\n    function addActive(x) {\n        if (!x) {\n            return;\n        }\n        removeActive(x);\n        if (currentFocus >= x.length) {\n            currentFocus = 0;\n        }\n        if (currentFocus < 0) {\n            currentFocus = (x.length - 1);\n        }\n        x[currentFocus].classList.add(\"autocomplete-active\");\n    }\n\n    /**\n     * Remove active.\n     * @param {*} x\n     */\n    function removeActive(x) {\n        for (var i = 0; i < x.length; i++) {\n            x[i].classList.remove(\"autocomplete-active\");\n        }\n    }\n\n    /**\n     * Close all list elements.\n     * @param {*} elmnt\n     */\n    function closeAllLists(elmnt) {\n        var x = document.getElementsByClassName(\"autocomplete-items\");\n        for (var i = 0; i < x.length; i++) {\n            if (elmnt != x[i] && elmnt != inp) {\n            x[i].parentNode.removeChild(x[i]);\n            }\n        }\n    }\n    document.addEventListener(\"click\", function (e) {\n        closeAllLists(e.target);\n    });\n  };\n"],"file":"cachier.min.js"}