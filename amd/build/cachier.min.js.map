{"version":3,"sources":["../src/cachier.js"],"names":["init","users","userid","console","log","document","getElementById","classList","remove","buybutton","querySelector","addEventListener","confirmPayment","checkoutbutton","add","event","autocomplete","input","filter","value","toUpperCase","li","querySelectorAll","i","length","a","txtValue","textContent","innerText","indexOf","style","display","Ajax","call","methodname","args","done","data","status","items","forEach","item","totalprices","fail","ex","validateCart","$userid","alert","inp","arr","currentFocus","useridfield","b","val","closeAllLists","createElement","setAttribute","id","parentNode","appendChild","index","innerHTML","substr","getElementsByTagName","split","e","x","keyCode","addActive","preventDefault","click","removeActive","elmnt","getElementsByClassName","removeChild","target"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * @package    local_shopping_cart\r\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Ajax from 'core/ajax';\r\n\r\nexport const init = (users, userid = 0) => {\r\n    // eslint-disable-next-line no-console\r\n    console.log('run init', userid);\r\n\r\n    document.getElementById('checkout-tab').classList.remove('success');\r\n\r\n    const buybutton = document.querySelector('#buy-btn');\r\n        // eslint-disable-next-line no-console\r\n        console.log(buybutton);\r\n        if (buybutton) {\r\n            buybutton.addEventListener('click', function() {\r\n                confirmPayment(userid);\r\n            });\r\n        }\r\n\r\n    const checkoutbutton = document.querySelector('#checkout-btn');\r\n    // eslint-disable-next-line no-console\r\n    console.log(checkoutbutton);\r\n    if (checkoutbutton) {\r\n        checkoutbutton.addEventListener('click', function() {\r\n\r\n            document.getElementById('checkout-tab').classList.add('success');\r\n            // eslint-disable-next-line no-console\r\n            console.log('click');\r\n        });\r\n    }\r\n\r\n\r\n    document.addEventListener('DOMContentLoaded', function(event) {\r\n\r\n        // eslint-disable-next-line no-console\r\n        console.log('content loaded', event);\r\n\r\n\r\n\r\n\r\n    });\r\n    autocomplete(document.getElementById(\"searchuser\"), users);\r\n    attachFilterFuntion();\r\n\r\n     /**\r\n      * Attach filter function.\r\n      */\r\n    function attachFilterFuntion() {\r\n        const input = document.querySelector(\"#shoppingcartfilterinput\");\r\n        input.addEventListener(\"keyup\", () => {\r\n            const filter = input.value.toUpperCase();\r\n            const li = document.querySelectorAll(\".list-group-item.wunderbyteTableJavascript\");\r\n            for (let i = 0; i < li.length; i++) {\r\n                const a = li[i];\r\n                const txtValue = a.textContent || a.innerText;\r\n                if (txtValue.toUpperCase().indexOf(filter) > -1) {\r\n                    li[i].style.display = \"\";\r\n                } else {\r\n                    li[i].style.display = \"none\";\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Confirm successful payment via ajax.\r\n     * @param {integer} userid\r\n     */\r\n    function confirmPayment(userid) {\r\n        Ajax.call([{\r\n            methodname: \"local_shopping_cart_confirm_cash_payment\",\r\n            args: {\r\n                'userid': userid\r\n            },\r\n            done: function(data) {\r\n\r\n                if (data.status == 1) {\r\n                    // eslint-disable-next-line no-console\r\n                    console.log('payment confirmed');\r\n                    document.getElementById('success-tab').classList.add('success');\r\n\r\n                    // We might display the item more often than once.\r\n                    let items = document.querySelectorAll('ul.shopping-cart-items li.clearfix');\r\n\r\n                    items.forEach(item => {\r\n                        // eslint-disable-next-line no-console\r\n                        console.log(item);\r\n                        if (item) {\r\n                            item.remove();\r\n                        }\r\n                    });\r\n                    let totalprices = document.querySelectorAll('#shopping_cart-cashiers-section .totalprice');\r\n\r\n                    totalprices.forEach(item => {\r\n                        // eslint-disable-next-line no-console\r\n                        console.log(item);\r\n                        if (item) {\r\n                            item.innerText = 0;\r\n                        }\r\n                    });\r\n\r\n                } else {\r\n                    // eslint-disable-next-line no-console\r\n                    console.log('payment denied');\r\n                    document.getElementById('success-tab').classList.add('error');\r\n                }\r\n            },\r\n            fail: function(ex) {\r\n                // eslint-disable-next-line no-console\r\n                console.log(ex);\r\n            },\r\n        }]);\r\n    }\r\n};\r\n\r\nexport const validateCart = ($userid) => {\r\n    // eslint-disable-next-line no-alert\r\n    alert($userid);\r\n };\r\n\r\n/**\r\n * The autocomplete function takes two arguments.\r\n * The text field element and an array of possible autocompleted values.\r\n * @param {string} inp\r\n * @param {array} arr\r\n */\r\n export const autocomplete = (inp, arr) => {\r\n    var currentFocus;\r\n    const useridfield = document.querySelector('#useridfield');\r\n    inp.addEventListener(\"input\", function() {\r\n        var a, b, i, val = this.value;\r\n        closeAllLists();\r\n        if (!val) {\r\n            return false;\r\n        }\r\n        currentFocus = -1;\r\n        a = document.createElement(\"DIV\");\r\n        a.setAttribute(\"id\", this.id + \"autocomplete-list\");\r\n        a.setAttribute(\"class\", \"autocomplete-items\");\r\n        this.parentNode.appendChild(a);\r\n        for (i = 0; i < arr.length; i++) {\r\n            if (arr[i].toUpperCase().indexOf(val.toUpperCase()) > -1) {\r\n                /*create a DIV element for each matching element:*/\r\n                b = document.createElement(\"DIV\");\r\n                /*make the matching letters bold:*/\r\n                let index = arr[i].toUpperCase().indexOf(val.toUpperCase());\r\n                b.innerHTML = arr[i].substr(0, index);\r\n                b.innerHTML += \"<strong>\" + arr[i].substr(arr[i].toUpperCase().indexOf(val.toUpperCase()), val.length) + \"</strong>\";\r\n                b.innerHTML += arr[i].substr(index + val.length);\r\n                /*insert a input field that will hold the current array item's value:*/\r\n                b.innerHTML += \"<input type='hidden' value='\" + arr[i] + \"'>\";\r\n                b.addEventListener(\"click\", function() {\r\n                    inp.value = this.getElementsByTagName(\"input\")[0].value;\r\n                    useridfield.value = this.getElementsByTagName(\"input\")[0].value.split('uid:')[1];\r\n                    closeAllLists();\r\n                });\r\n                a.appendChild(b);\r\n            }\r\n        }\r\n    });\r\n\r\n    inp.addEventListener(\"keydown\", function(e) {\r\n        var x = document.getElementById(this.id + \"autocomplete-list\");\r\n        if (x) {\r\n            x = x.getElementsByTagName(\"div\");\r\n        }\r\n        if (e.keyCode == 40) {\r\n          currentFocus++;\r\n          addActive(x);\r\n        } else if (e.keyCode == 38) {\r\n          currentFocus--;\r\n          addActive(x);\r\n        } else if (e.keyCode == 13) {\r\n          e.preventDefault();\r\n          if (currentFocus > -1) {\r\n            if (x) {\r\n                x[currentFocus].click();\r\n            }\r\n          }\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Add active.\r\n     * @param {*} x\r\n     */\r\n    function addActive(x) {\r\n        if (!x) {\r\n            return;\r\n        }\r\n        removeActive(x);\r\n        if (currentFocus >= x.length) {\r\n            currentFocus = 0;\r\n        }\r\n        if (currentFocus < 0) {\r\n            currentFocus = (x.length - 1);\r\n        }\r\n        x[currentFocus].classList.add(\"autocomplete-active\");\r\n    }\r\n\r\n    /**\r\n     * Remove active.\r\n     * @param {*} x\r\n     */\r\n    function removeActive(x) {\r\n        for (var i = 0; i < x.length; i++) {\r\n            x[i].classList.remove(\"autocomplete-active\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Close all list elements.\r\n     * @param {*} elmnt\r\n     */\r\n    function closeAllLists(elmnt) {\r\n        var x = document.getElementsByClassName(\"autocomplete-items\");\r\n        for (var i = 0; i < x.length; i++) {\r\n            if (elmnt != x[i] && elmnt != inp) {\r\n            x[i].parentNode.removeChild(x[i]);\r\n            }\r\n        }\r\n    }\r\n    document.addEventListener(\"click\", function (e) {\r\n        closeAllLists(e.target);\r\n    });\r\n  };\r\n"],"file":"cachier.min.js"}