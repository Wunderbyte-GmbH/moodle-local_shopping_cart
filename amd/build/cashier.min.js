define("local_shopping_cart/cashier",["exports","core/ajax","core/url","local_shopping_cart/notifications","core_form/modalform","local_shopping_cart/cart","core/str"],(function(_exports,_ajax,_url,_notifications,_modalform,_cart,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    local_shopping_cart
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.confirmPayment=_exports.autocomplete=_exports.addPrintIdentifier=void 0,_exports.discountModal=function(event){const element=event.target.closest("li");console.log("closest",element);const price=element.dataset.price,itemid=element.dataset.itemid,userid=element.dataset.userid,componentname=element.dataset.component;console.log("discountModal",price,itemid,userid,componentname);const modalForm=new _modalform.default({formClass:"local_shopping_cart\\form\\modal_add_discount_to_item",args:{price:price,itemid:itemid,userid:userid,componentname:componentname},modalConfig:{title:(0,_str.get_string)("applydiscount","local_shopping_cart")},returnFocus:element});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const response=e.detail;console.log("confirmCancelAndSetCreditModal response: ",response),(0,_cart.reinit)(-1)})),modalForm.show()},_exports.validateCart=_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_url=_interopRequireDefault(_url),_modalform=_interopRequireDefault(_modalform);_exports.init=function(users){let userid=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;console.log("run init",userid),document.getElementById("checkout-tab").classList.remove("success");const buybuttons=document.querySelectorAll(".buy-btn");buybuttons&&buybuttons.forEach((buybutton=>{buybutton.addEventListener("click",(e=>confirmPayment(userid,e.target.dataset.paymenttype)))}));const checkoutbutton=document.querySelector("#checkout-btn");console.log(checkoutbutton),checkoutbutton&&checkoutbutton.addEventListener("click",(function(){document.getElementById("checkout-tab").classList.add("success"),console.log("click")})),autocomplete(document.getElementById("shopping-cart-searchuser"),users)};const confirmPayment=(userid,paymenttype)=>{_ajax.default.call([{methodname:"local_shopping_cart_confirm_cash_payment",args:{userid:userid,paymenttype:paymenttype},done:function(data){if(1===data.status){console.log("payment confirmed",data);if(window.location.href.indexOf("cashier.php")<1){let params={success:1,identifier:data.identifier};const newurl=_url.default.relativeUrl("/local/shopping_cart/checkout.php",params,!1);location.href=newurl}else addPrintIdentifier(data.identifier,userid),document.getElementById("success-tab").classList.add("success"),displayPaymentMessage("paymentsuccessful")}else console.log("payment denied"),displayPaymentMessage("paymentdenied",!1),document.getElementById("success-tab").classList.add("error")},fail:function(ex){displayPaymentMessage("paymentdenied",!1),console.log(ex)}}])};_exports.confirmPayment=confirmPayment;_exports.validateCart=$userid=>{alert($userid)};const addPrintIdentifier=(identifier,userid)=>{let printbtn=document.getElementById("printbtn"),href=printbtn.getAttribute("href");printbtn.setAttribute("href",href+identifier+"&userid="+userid)};_exports.addPrintIdentifier=addPrintIdentifier;const autocomplete=(inp,arr)=>{var currentFocus;const useridfield=document.querySelector("#useridfield");function addActive(x){x&&(!function(x){for(var i=0;i<x.length;i++)x[i].classList.remove("autocomplete-active")}(x),currentFocus>=x.length&&(currentFocus=0),currentFocus<0&&(currentFocus=x.length-1),x[currentFocus].classList.add("autocomplete-active"))}function closeAllLists(elmnt){for(var x=document.getElementsByClassName("autocomplete-items"),i=0;i<x.length;i++)elmnt!==x[i]&&elmnt!==inp&&x[i].parentNode.removeChild(x[i])}inp.addEventListener("input",(function(){var a,b,i;let val=this.value;if(closeAllLists(),!val)return!1;for(currentFocus=-1,(a=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),a.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(a),i=0;i<arr.length;i++)if(arr[i].toUpperCase().indexOf(val.toUpperCase())>-1){let index=arr[i].toUpperCase().indexOf(val.toUpperCase());b=document.createElement("DIV");const namearray=arr[i].split(" "),firstname=namearray[0].toLowerCase(),lastname=namearray[1].toLowerCase(),email=namearray[2].toLowerCase().replace(/^\(/,"").replace(/\)$/,""),userid=namearray[3].toLowerCase().replace(/^uid:/,"");b.dataset.firstname=firstname,b.dataset.lastname=lastname,b.id="li_"+firstname+"_"+lastname,b.dataset.email=email,b.dataset.userid=userid,b.innerHTML=arr[i].substr(0,index),b.innerHTML+="<strong>"+arr[i].substr(arr[i].toUpperCase().indexOf(val.toUpperCase()),val.length)+"</strong>",b.innerHTML+=arr[i].substr(index+val.length),b.innerHTML+="<input type='hidden' value='"+arr[i]+"'>",b.addEventListener("click",(function(){inp.value=this.getElementsByTagName("input")[0].value,useridfield.value=this.getElementsByTagName("input")[0].value.split("uid:")[1],closeAllLists()})),a.appendChild(b)}return null})),inp.addEventListener("keydown",(function(e){var x=document.getElementById(this.id+"autocomplete-list");x&&(x=x.getElementsByTagName("div")),40===e.keyCode?(currentFocus++,addActive(x)):38===e.keyCode?(currentFocus--,addActive(x)):13===e.keyCode&&(e.preventDefault(),currentFocus>-1&&x&&x[currentFocus].click())})),document.addEventListener("click",(function(e){closeAllLists(e.target)}))};function displayPaymentMessage(message){let success=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],displaymessage=document.querySelector(".payment_message_result");displaymessage&&(0,_str.get_string)(message,"local_shopping_cart").then((localizedmessage=>{displaymessage.innerText=localizedmessage,success?(0,_notifications.showNotification)(localizedmessage,"info"):(0,_notifications.showNotification)(localizedmessage,"error")})).catch((e=>{console.log(e)}))}_exports.autocomplete=autocomplete}));

//# sourceMappingURL=cashier.min.js.map