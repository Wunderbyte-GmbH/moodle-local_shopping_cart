{"version":3,"sources":["../src/shistory.js"],"names":["init","buttons","document","querySelectorAll","forEach","button","dataset","initialized","console","log","canceled","historyid","setButtonToCanceled","addEventListener","event","preventDefault","stopPropagation","confirmDecisionModal","cancelPurchase","itemid","userid","componentname","Ajax","call","methodname","args","done","data","success","then","message","Notification","addNotification","type","setTimeout","notificationslist","notificatonelement","length","remove","catch","e","fail","ex","classList","add","result","innerText","key","component","strings","ModalFactory","create","types","SAVE_CANCEL","modal","setTitle","setBody","setSaveButtonText","getRoot","on","ModalEvents","save","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_shopping_cart\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport {\n    get_string as getString,\n    get_strings as getStrings\n        }\n        from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nexport const init = () => {\n\n    const buttons = document.querySelectorAll(\"#shopping_cart-cashiers-section .shopping_cart_history_cancel_button\");\n\n        buttons.forEach(button => {\n\n            if (!button.dataset.initialized) {\n\n                // eslint-disable-next-line no-console\n                console.log(button.dataset.canceled, button.dataset.historyid);\n\n                if (button.dataset.canceled == true) {\n                    setButtonToCanceled(button);\n                } else {\n                    button.addEventListener('click', event => {\n\n                        event.preventDefault();\n                        event.stopPropagation();\n\n                        if (button.dataset.canceled == false) {\n                            // eslint-disable-next-line no-console\n                            console.log('button clicked');\n\n                            confirmDecisionModal(button);\n\n                        }\n\n                    });\n                }\n                button.dataset.initialized = true;\n            }\n        });\n};\n\n/**\n * This triggers the ajax call to acutally cancel the purchase.\n * @param {int} itemid\n * @param {int} userid\n * @param {string} componentname\n * @param {int} historyid\n * @param {type} button\n */\nfunction cancelPurchase(itemid, userid, componentname, historyid, button) {\n\n    // eslint-disable-next-line no-console\n    console.log('button clicked', historyid);\n\n    Ajax.call([{\n        methodname: \"local_shopping_cart_cancel_purchase\",\n        args: {\n            'itemid': itemid,\n            'componentname': componentname,\n            'userid': userid,\n            'historyid': historyid\n        },\n        done: function(data) {\n\n            if (data.success == 1) {\n\n                getString('cancelsuccess', 'local_shopping_cart').then(message => {\n\n                    Notification.addNotification({\n                        message,\n                        type: \"success\"\n                    });\n\n                    setTimeout(() => {\n                        let notificationslist = document.querySelectorAll('#user-notifications div.alert');\n                        const notificatonelement = notificationslist[notificationslist.length - 1];\n                        notificatonelement.remove();\n                    }, 5000);\n\n                    return;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n\n                // eslint-disable-next-line no-console\n                console.log('data returned', data.success);\n                setButtonToCanceled(button);\n            } else {\n                getString('canceldidntwork', 'local_shopping_cart').then(message => {\n\n                    Notification.addNotification({\n                        message,\n                        type: \"danger\"\n                    });\n\n                    setTimeout(() => {\n                        let notificationslist = document.querySelectorAll('#user-notifications div.alert');\n                        const notificatonelement = notificationslist[notificationslist.length - 1];\n                        notificatonelement.remove();\n                    }, 5000);\n\n                    return;\n                }).catch(e => {\n                    // eslint-disable-next-line no-console\n                    console.log(e);\n                });\n            }\n\n        },\n        fail: function(ex) {\n            // eslint-disable-next-line no-console\n            console.log(\"ex:\" + ex);\n        },\n    }]);\n\n}\n\n/**\n * Function to change classes and text of button.\n * @param {*} button\n */\nfunction setButtonToCanceled(button) {\n\n    button.classList.add('disabled');\n    button.classList.remove('btn-primary');\n    button.classList.add('btn-danger');\n    button.dataset.canceled = true;\n\n    getString('canceled', 'local_shopping_cart').then(result => {\n        // eslint-disable-next-line no-console\n        console.log(result);\n\n        button.innerText = result;\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n}\n\n/**\n *\n * @param {*} button\n */\nfunction confirmDecisionModal(button) {\n\n    getStrings([\n            {key: 'confirmcanceltitle', component: 'local_shopping_cart'},\n            {key: 'confirmcancelbody', component: 'local_shopping_cart'},\n            {key: 'cancelpurchase', component: 'local_shopping_cart'}\n        ]\n        ).then(strings => {\n\n            ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL}).then(modal => {\n\n                modal.setTitle(strings[0]);\n                    modal.setBody(strings[1]);\n                    modal.setSaveButtonText(strings[2]);\n                    modal.getRoot().on(ModalEvents.save, function() {\n\n                        // eslint-disable-next-line no-console\n                        console.log('we saved');\n\n                        const historyid = button.dataset.historyid;\n                        const itemid = button.dataset.itemid;\n                        const userid = button.dataset.userid;\n                        const componentname = button.dataset.componentname;\n\n                        cancelPurchase(itemid, userid, componentname, historyid, button);\n                    });\n\n                    modal.show();\n                    return modal;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            return true;\n        }).catch(e => {\n            // eslint-disable-next-line no-console\n            console.log(e);\n        });\n}"],"file":"shistory.min.js"}